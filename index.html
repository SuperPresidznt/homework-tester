<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WGU Practice Platform</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
/* === RESET & VARIABLES === */
*{box-sizing:border-box;margin:0;padding:0}
:root{
    --navy:#1a3a5c;--navy-dark:#0d2137;--blue:#2980b9;--blue-light:#3498db;
    --green:#27ae60;--green-light:#2ecc71;--red:#c0392b;--red-light:#e74c3c;
    --orange:#f39c12;--yellow:#ffd60a;
    --bg:#e8e8e8;--white:#fff;--gray-50:#f5f5f5;--gray-100:#eee;
    --gray-200:#ddd;--gray-300:#ccc;--gray-500:#999;--gray-600:#777;
    --gray-700:#555;--gray-800:#333;--gray-900:#222;
    --radius:4px;--shadow:0 2px 8px rgba(0,0,0,.12);
}
body{font-family:Arial,Helvetica,sans-serif;font-size:14px;background:var(--bg);color:var(--gray-800);min-height:100vh;-webkit-tap-highlight-color:transparent}
a{color:var(--blue);text-decoration:none}
a:hover{text-decoration:underline}
button{font-family:inherit;cursor:pointer}

/* === HEADER === */
.main-header{background:linear-gradient(to bottom,var(--navy),var(--navy-dark));color:#fff;border-bottom:3px solid var(--blue)}
.header-top{display:flex;align-items:center;justify-content:space-between;padding:8px 20px;min-height:55px}
.logo-area{display:flex;align-items:center;gap:12px}
.logo-text{font-size:18px;font-weight:bold;letter-spacing:.5px}
.header-actions{display:flex;align-items:center;gap:12px}
.header-actions button{background:none;border:1px solid rgba(255,255,255,.3);color:#fff;padding:5px 12px;border-radius:var(--radius);font-size:12px}
.header-actions button:hover{background:rgba(255,255,255,.1)}

/* === SUBHEADER === */
.subheader{background:var(--gray-50);border-bottom:1px solid var(--gray-300);display:flex;align-items:center;justify-content:space-between;padding:6px 20px;min-height:40px;flex-wrap:wrap;gap:8px}
.test-name{font-size:15px;font-weight:bold;color:var(--navy)}
.test-name span{background:#ff0;padding:1px 6px}
.section-tab{display:inline-block;background:var(--navy);color:#fff;padding:5px 16px;border-radius:3px 3px 0 0;font-size:13px;font-weight:bold}
.timer-area{display:flex;align-items:center;gap:10px;font-size:13px;color:var(--gray-700)}
.timer-display{font-family:'Courier New',monospace;font-size:16px;font-weight:bold;color:var(--red);background:#fff;border:1px solid var(--gray-300);padding:3px 10px;border-radius:3px}
.timer-display.warning{animation:flash .5s infinite alternate}
@keyframes flash{from{background:#fff}to{background:#ffeaea;color:#c0392b}}
.timer-toggle{color:var(--blue);cursor:pointer;font-size:12px}

/* === SCREENS === */
.screen{display:none;max-width:960px;margin:0 auto;padding:20px;min-height:calc(100vh - 200px)}
.screen.active{display:block}

/* === HOME SCREEN === */
.home-hero{text-align:center;padding:30px 0 20px}
.home-hero h1{color:var(--navy);font-size:28px;margin-bottom:8px}
.home-hero p{color:var(--gray-600);font-size:15px}

.stats-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin:20px 0}
.stat-card{background:var(--white);border:1px solid var(--gray-200);border-radius:8px;padding:16px;text-align:center}
.stat-card .stat-val{font-size:28px;font-weight:bold;color:var(--navy)}
.stat-card .stat-lbl{font-size:12px;color:var(--gray-600);margin-top:4px}

.bank-card{background:var(--white);border:1px solid var(--gray-200);border-radius:8px;padding:20px;margin:16px 0;box-shadow:var(--shadow)}
.bank-card h2{color:var(--navy);font-size:20px;margin-bottom:4px}
.bank-card .bank-desc{color:var(--gray-600);font-size:13px;margin-bottom:16px}
.bank-card .bank-meta{display:flex;gap:16px;font-size:12px;color:var(--gray-600);margin-bottom:16px;flex-wrap:wrap}

.mode-buttons{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px}
.mode-btn{padding:14px 16px;border:2px solid var(--gray-200);border-radius:8px;background:var(--white);text-align:left;transition:all .15s}
.mode-btn:hover{border-color:var(--blue);background:#f0f7ff}
.mode-btn h3{font-size:14px;color:var(--navy);margin-bottom:4px}
.mode-btn p{font-size:12px;color:var(--gray-600);line-height:1.4}
.mode-btn.m-test{border-left:4px solid var(--red)}
.mode-btn.m-practice{border-left:4px solid var(--green)}
.mode-btn.m-drill{border-left:4px solid var(--orange)}
.mode-btn.m-review{border-left:4px solid var(--blue)}

/* === QUESTION CONTAINER === */
.question-container{background:#fff;border:1px solid var(--gray-300);border-radius:var(--radius);padding:25px 30px;margin-bottom:15px;min-height:250px}
.question-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;padding-bottom:10px;border-bottom:1px solid var(--gray-100);flex-wrap:wrap;gap:8px}
.question-number{font-weight:bold;color:var(--navy);font-size:14px}
.question-actions{display:flex;gap:8px}
.btn-bookmark,.btn-clear{padding:4px 14px;border:1px solid var(--gray-500);border-radius:3px;background:#f0f0f0;font-size:12px;color:var(--gray-700)}
.btn-bookmark:hover,.btn-clear:hover{background:#e0e0e0}
.btn-bookmark.flagged{background:#fff3cd;border-color:var(--orange);color:#856404}
.question-text{font-size:15px;line-height:1.7;margin-bottom:20px;color:var(--gray-900)}
.question-text p{margin-bottom:8px}

/* === OPTIONS === */
.options-list{list-style:none}
.option-item{display:flex;align-items:flex-start;gap:10px;padding:10px 14px;margin:6px 0;border:1px solid var(--gray-200);border-radius:var(--radius);cursor:pointer;transition:background .15s}
.option-item:hover{background:#f0f7ff;border-color:var(--blue)}
.option-item.selected{background:#e3f0fc;border-color:var(--blue)}
.option-item input[type="radio"]{margin-top:3px;accent-color:var(--blue)}
.option-label{font-size:14px;line-height:1.6;color:var(--gray-800)}

/* Practice/Review feedback on options */
.option-item.correct-answer{border:2px solid var(--green);background:#eafaf1}
.option-item.wrong-answer{border:2px solid var(--red);background:#fdf2f2}

/* === EXPLANATION PANEL === */
.explanation-panel{display:none;margin-top:15px;padding:16px;border-radius:var(--radius);background:#f0faf4;border:1px solid #c3e6cb;font-size:14px;line-height:1.6;color:#155724}
.explanation-panel.show{display:block}
.explanation-panel.incorrect{background:#fdf2f2;border-color:#f5c6cb;color:#721c24}
.explanation-panel h4{margin-bottom:6px}

/* === CHECK ANSWER BUTTON (Practice mode) === */
.btn-check{padding:10px 24px;background:var(--green);color:#fff;border:none;border-radius:var(--radius);font-size:14px;font-weight:bold;margin-top:10px}
.btn-check:hover{background:var(--green-light)}
.btn-check:disabled{background:var(--gray-500);cursor:not-allowed}

/* === TOOLBAR (Calculator, Audio, Timer) === */
.toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.tool-btn{background:var(--gray-100);border:1px solid var(--gray-300);border-radius:var(--radius);padding:6px 12px;font-size:12px;color:var(--gray-700);display:flex;align-items:center;gap:4px}
.tool-btn:hover{background:var(--gray-200)}
.tool-btn.active{background:var(--blue);color:#fff;border-color:var(--blue)}
.tool-btn svg{width:14px;height:14px}

/* === CALCULATOR === */
.calc-panel{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border-radius:8px;box-shadow:0 8px 32px rgba(0,0,0,.3);z-index:400;width:280px}
.calc-panel.open{display:block}
.calc-header{background:var(--navy);color:#fff;padding:10px 14px;display:flex;justify-content:space-between;align-items:center;border-radius:8px 8px 0 0}
.calc-header h4{font-size:14px;margin:0}
.calc-close{background:none;border:none;color:#fff;font-size:18px;cursor:pointer}
.calc-display{background:#222;color:#0f0;font-family:monospace;font-size:24px;padding:12px;text-align:right;min-height:50px;word-break:break-all}
.calc-buttons{display:grid;grid-template-columns:repeat(4,1fr);gap:2px;padding:8px}
.calc-btn{padding:14px;font-size:16px;border:none;background:var(--gray-100);cursor:pointer}
.calc-btn:hover{background:var(--gray-200)}
.calc-btn.op{background:var(--orange);color:#fff}
.calc-btn.op:hover{background:#e67e22}
.calc-btn.eq{background:var(--green);color:#fff}
.calc-btn.clear{background:var(--red);color:#fff}

/* === METRICS PANEL === */
.metrics-summary{background:var(--gray-50);border:1px solid var(--gray-200);border-radius:8px;padding:16px;margin-top:20px}
.metrics-summary h3{font-size:14px;color:var(--navy);margin-bottom:12px}
.metrics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px}
.metric-item{text-align:center}
.metric-val{font-size:20px;font-weight:bold;color:var(--navy)}
.metric-lbl{font-size:11px;color:var(--gray-600)}
.time-per-q{margin-top:12px;font-size:12px;color:var(--gray-600)}
.time-per-q table{width:100%;margin-top:8px;font-size:11px}
.time-per-q th,.time-per-q td{padding:4px 8px;text-align:left;border-bottom:1px solid var(--gray-200)}
.time-bar{height:8px;background:var(--gray-200);border-radius:4px;overflow:hidden;margin-top:2px}
.time-bar-fill{height:100%;background:var(--blue);border-radius:4px}

/* === FOOTER NAV === */
.footer-nav{background:var(--gray-50);border-top:1px solid var(--gray-300);padding:10px 20px;position:sticky;bottom:0;z-index:50}
.nav-controls{display:flex;align-items:center;justify-content:space-between;max-width:960px;margin:0 auto;gap:10px;flex-wrap:wrap}
.nav-buttons{display:flex;gap:8px;flex-shrink:0}
.btn-nav{padding:8px 20px;border:1px solid var(--navy);border-radius:3px;background:var(--navy);color:#fff;font-size:13px;font-weight:bold}
.btn-nav:hover{background:#2c5a8a}
.btn-nav:disabled{background:var(--gray-500);border-color:var(--gray-500);cursor:not-allowed}
.btn-submit{background:var(--red);border-color:var(--red)}
.btn-submit:hover{background:var(--red-light)}
.btn-home{background:var(--gray-700);border-color:var(--gray-700)}

/* === QUESTION PALETTE === */
.palette-wrap{text-align:center;min-width:0;overflow:hidden}
.question-palette{display:flex;flex-wrap:wrap;gap:4px;justify-content:center;max-width:600px;margin:0 auto}
.q-num{width:32px;height:28px;display:flex;align-items:center;justify-content:center;border:1px solid var(--gray-500);border-radius:3px;cursor:pointer;font-size:12px;font-weight:bold;background:#fff;color:#666;transition:all .15s;flex-shrink:0}
.q-num:hover{border-color:var(--blue);color:var(--blue)}
.q-num.current{background:var(--navy);color:#fff;border-color:var(--navy)}
.q-num.answered{background:var(--green);color:#fff;border-color:var(--green)}
.q-num.visited{color:#996600}
.q-num.flagged{position:relative}
.q-num.flagged::after{content:'';position:absolute;top:-2px;right:-2px;width:8px;height:8px;background:var(--orange);border-radius:50%}
/* Practice palette colors */
.q-num.p-correct{background:var(--green);color:#fff;border-color:var(--green)}
.q-num.p-incorrect{background:var(--red);color:#fff;border-color:var(--red)}
.q-num.p-skipped{background:var(--orange);color:#fff;border-color:var(--orange)}

.palette-legend{display:flex;gap:15px;font-size:11px;color:var(--gray-600);margin-top:8px;justify-content:center;flex-wrap:wrap}
.legend-item{display:flex;align-items:center;gap:4px}
.legend-dot{width:12px;height:12px;border-radius:2px;border:1px solid var(--gray-500)}
.legend-dot.lg-current{background:var(--navy);border-color:var(--navy)}
.legend-dot.lg-answered{background:var(--green);border-color:var(--green)}
.legend-dot.lg-unanswered{background:#fff}
.legend-dot.lg-flagged{background:var(--orange);border-color:var(--orange)}

/* === MINI PALETTE (shows ~5 around current) === */
.palette-mini{display:flex;gap:4px;justify-content:center;align-items:center;margin-bottom:6px}
.palette-mini .q-num{width:36px;height:32px;font-size:13px}
.palette-mini .pm-ellipsis{color:var(--gray-500);font-size:14px;padding:0 4px}
.palette-expand-btn{background:none;border:1px solid var(--gray-400);color:var(--gray-600);padding:4px 12px;border-radius:12px;font-size:11px;margin-bottom:6px}
.palette-expand-btn:hover{background:var(--gray-100)}
.question-palette.collapsed{display:none}
.question-palette.expanded{display:flex}

/* === MODAL === */
.modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:1000}
.modal-overlay.active{display:flex;align-items:center;justify-content:center}
.modal{background:#fff;border-radius:6px;padding:30px;max-width:500px;width:90%;max-height:80vh;overflow-y:auto}
.modal h2{color:var(--navy);margin-bottom:15px;font-size:18px}
.modal table{width:100%;border-collapse:collapse;margin:15px 0}
.modal th,.modal td{padding:8px 12px;border:1px solid var(--gray-200);text-align:left;font-size:13px}
.modal th{background:var(--navy);color:#fff}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:20px}
.modal .btn-nav{font-size:14px;padding:10px 24px}

/* === SCORE SCREEN === */
.score-screen{text-align:center;padding:40px 20px}
.score-big{font-size:64px;font-weight:bold;color:var(--navy)}
.score-big.pass{color:var(--green)}
.score-big.fail{color:var(--red)}
.score-label{font-size:18px;color:var(--gray-600);margin:10px 0 20px}
.score-details{max-width:450px;margin:0 auto;text-align:left}
.score-details table{width:100%;border-collapse:collapse}
.score-details td{padding:6px 10px;font-size:14px;border-bottom:1px solid var(--gray-100)}
.score-details .label-col{color:var(--gray-600)}
.score-details .value-col{font-weight:bold;text-align:right}
.category-breakdown{margin-top:20px}
.category-breakdown h3{font-size:16px;color:var(--navy);margin-bottom:10px}
.cat-row{display:flex;align-items:center;gap:10px;margin:6px 0;font-size:13px}
.cat-bar{flex:1;height:20px;background:var(--gray-100);border-radius:10px;overflow:hidden}
.cat-fill{height:100%;border-radius:10px;transition:width .5s}
.cat-fill.good{background:var(--green)}
.cat-fill.warn{background:var(--orange)}
.cat-fill.bad{background:var(--red)}
.score-actions{margin-top:30px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.score-actions button{padding:12px 28px;border:none;border-radius:var(--radius);font-size:15px;font-weight:bold;color:#fff;cursor:pointer}

/* === DRILL MODE === */
.drill-container{max-width:700px;margin:0 auto}
.drill-progress{text-align:center;color:var(--gray-600);font-size:14px;margin-bottom:20px}
.drill-progress .due-count{font-weight:bold;color:var(--navy)}
.drill-card{background:#fff;border:1px solid var(--gray-300);border-radius:8px;padding:30px;min-height:300px;box-shadow:var(--shadow)}
.drill-card .question-text{font-size:16px}
.drill-answer{display:none;margin-top:20px;padding-top:20px;border-top:2px solid var(--gray-200)}
.drill-answer.show{display:block}
.drill-answer .correct-label{font-weight:bold;color:var(--green);font-size:15px;margin-bottom:8px}
.drill-answer .explanation{color:var(--gray-700);font-size:14px;line-height:1.6}
.drill-buttons{display:flex;gap:10px;margin-top:20px;justify-content:center;flex-wrap:wrap}
.drill-btn{padding:12px 24px;border:none;border-radius:var(--radius);font-size:14px;font-weight:bold;color:#fff;min-width:120px}
.drill-btn.btn-got-it{background:var(--green)}
.drill-btn.btn-struggled{background:var(--orange)}
.drill-btn.btn-missed{background:var(--red)}
.drill-btn.btn-show{background:var(--blue);min-width:200px}
.drill-session-done{text-align:center;padding:40px}
.drill-session-done h2{color:var(--navy);margin-bottom:10px}

/* === REVIEW MODE === */
.review-controls{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;align-items:center}
.review-controls select,.review-controls input{padding:8px 12px;border:1px solid var(--gray-300);border-radius:var(--radius);font-size:13px}
.review-controls input{flex:1;min-width:200px}
.review-category{margin-bottom:20px}
.review-category h3{color:var(--navy);font-size:16px;padding:10px 0;border-bottom:2px solid var(--navy);cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.review-category h3 .toggle-arrow{transition:transform .2s}
.review-category h3 .toggle-arrow.collapsed{transform:rotate(-90deg)}
.review-q{background:#fff;border:1px solid var(--gray-200);border-radius:var(--radius);padding:16px;margin:8px 0}
.review-q .rq-text{font-size:14px;line-height:1.6;margin-bottom:12px}
.review-q .rq-options{list-style:none}
.review-q .rq-opt{padding:6px 10px;margin:3px 0;border-radius:3px;font-size:13px}
.review-q .rq-opt.rq-correct{background:#eafaf1;border:1px solid #c3e6cb;font-weight:bold}
.review-q .rq-explanation{margin-top:10px;padding:10px;background:#f8f9fa;border-left:3px solid var(--yellow);font-size:13px;line-height:1.5;color:var(--gray-700)}
.review-q .rq-meta{display:flex;gap:8px;margin-top:8px;font-size:11px}
.review-q .rq-tag{background:var(--gray-100);padding:2px 6px;border-radius:3px;color:var(--gray-600)}

/* === SETTINGS === */
.settings-panel{max-width:600px;margin:0 auto}
.settings-panel h2{color:var(--navy);margin-bottom:20px}
.setting-group{background:#fff;border:1px solid var(--gray-200);border-radius:8px;padding:20px;margin-bottom:16px}
.setting-group h3{font-size:14px;color:var(--navy);margin-bottom:12px}
.setting-row{margin-bottom:12px}
.setting-row label{display:block;font-size:13px;color:var(--gray-700);margin-bottom:4px}
.setting-row input,.setting-row select{width:100%;padding:8px 12px;border:1px solid var(--gray-300);border-radius:var(--radius);font-size:14px}
.setting-row input[type="password"]{font-family:monospace}
.setting-row .hint{font-size:11px;color:var(--gray-600);margin-top:4px}
.setting-row button{margin-top:8px}
.btn-save-settings{padding:10px 24px;background:var(--green);color:#fff;border:none;border-radius:var(--radius);font-size:14px;font-weight:bold}

/* === AI CHAT BUBBLE === */
.chat-fab{position:fixed;bottom:80px;right:20px;width:50px;height:50px;border-radius:50%;background:var(--navy);color:#fff;border:none;font-size:22px;box-shadow:0 4px 12px rgba(0,0,0,.3);z-index:200;display:flex;align-items:center;justify-content:center;transition:transform .2s}
.chat-fab:hover{transform:scale(1.1)}
.chat-fab.has-context::after{content:'';position:absolute;top:2px;right:2px;width:10px;height:10px;background:var(--green);border-radius:50%;border:2px solid var(--navy)}

.chat-panel{display:none;position:fixed;bottom:80px;right:20px;width:360px;max-width:calc(100vw - 40px);height:460px;max-height:calc(100vh - 120px);background:#fff;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.25);z-index:300;flex-direction:column;overflow:hidden}
.chat-panel.open{display:flex}
.chat-header{background:var(--navy);color:#fff;padding:12px 16px;display:flex;justify-content:space-between;align-items:center;flex-shrink:0}
.chat-header h3{font-size:14px}
.chat-close{background:none;border:none;color:#fff;font-size:20px;cursor:pointer;padding:0 4px}
.chat-messages{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:8px}
.chat-msg{max-width:85%;padding:10px 14px;border-radius:12px;font-size:13px;line-height:1.5;word-wrap:break-word}
.chat-msg.user{align-self:flex-end;background:var(--blue);color:#fff;border-bottom-right-radius:4px}
.chat-msg.assistant{align-self:flex-start;background:var(--gray-50);color:var(--gray-800);border:1px solid var(--gray-200);border-bottom-left-radius:4px}
.chat-msg.system{align-self:center;background:#fffde7;color:#856404;font-size:12px;text-align:center;border-radius:8px}
.chat-input-area{display:flex;gap:8px;padding:12px;border-top:1px solid var(--gray-200);flex-shrink:0}
.chat-input-area input{flex:1;padding:8px 12px;border:1px solid var(--gray-300);border-radius:20px;font-size:13px;outline:none}
.chat-input-area input:focus{border-color:var(--blue)}
.chat-input-area button{background:var(--navy);color:#fff;border:none;border-radius:50%;width:36px;height:36px;font-size:16px;flex-shrink:0}

/* === MOBILE === */
@media(max-width:768px){
    .header-top{padding:8px 12px}
    .logo-text{font-size:15px}
    .subheader{padding:6px 12px}
    .screen{padding:12px}
    .question-container{padding:16px}
    .mode-buttons{grid-template-columns:1fr 1fr}
    .nav-controls{flex-direction:column;gap:8px}
    .nav-buttons{width:100%;justify-content:space-between;flex-wrap:wrap}
    .toolbar{width:100%;justify-content:center;margin-bottom:6px!important;margin-right:0!important}
    .tool-btn{flex:1;justify-content:center;padding:8px 6px;font-size:11px}
    .tool-btn svg{width:16px;height:16px}
    .question-palette{max-width:100%}
    .calc-panel{width:calc(100vw - 24px);max-width:320px}
    .q-num{width:28px;height:24px;font-size:11px}
    .score-big{font-size:48px}
    .chat-panel{width:calc(100vw - 24px);right:12px;bottom:70px;height:calc(100vh - 100px)}
    .chat-fab{bottom:70px;right:12px}
    .stats-row{grid-template-columns:repeat(2,1fr)}
    .home-hero h1{font-size:22px}
}
@media(max-width:400px){
    .mode-buttons{grid-template-columns:1fr}
    .q-num{width:24px;height:22px;font-size:10px}
}
</style>
</head>
<body>

<!-- HEADER -->
<div class="main-header">
    <div class="header-top">
        <div class="logo-area">
            <svg width="36" height="36" viewBox="0 0 40 40" fill="none"><rect width="40" height="40" rx="6" fill="#fff"/><text x="5" y="28" font-size="14" font-weight="bold" fill="#1a3a5c" font-family="Arial">WGU</text></svg>
            <span class="logo-text">Practice Platform</span>
        </div>
        <div class="header-actions">
            <button onclick="showScreen('home')">Home</button>
            <button onclick="showScreen('settings')">Settings</button>
        </div>
    </div>
</div>

<!-- SUBHEADER (test/practice modes) -->
<div class="subheader" id="subheader" style="display:none">
    <div style="display:flex;align-items:center;gap:20px;flex-wrap:wrap">
        <div class="test-name" id="testNameBar">Test</div>
        <div class="section-tab" id="modeTab">Test Mode</div>
    </div>
    <div class="timer-area">
        <span class="timer-toggle" id="timerToggle" onclick="App.toggleTimer()">Hide Timer</span>
        <span class="timer-display" id="timerDisplay">01:30:00</span>
    </div>
</div>

<!-- ========== HOME SCREEN ========== -->
<div class="screen active" id="screen-home">
    <div class="home-hero">
        <h1>WGU Practice Platform</h1>
        <p>Choose a question bank and study mode</p>
    </div>

    <div class="stats-row" id="homeStats"></div>

    <div id="bankList"></div>
</div>

<!-- ========== TEST / PRACTICE SCREEN ========== -->
<div class="screen" id="screen-exam">
    <div class="question-container" id="questionContainer">
        <div class="question-header">
            <span class="question-number" id="questionNumber">Question 1 of 70</span>
            <div class="question-actions">
                <button class="btn-bookmark" id="btnBookmark" onclick="App.toggleBookmark()">Bookmark</button>
                <button class="btn-clear" onclick="App.clearAnswer()">Clear</button>
            </div>
        </div>
        <div class="question-text" id="questionText"></div>
        <ul class="options-list" id="optionsList"></ul>
        <button class="btn-check" id="btnCheck" style="display:none" onclick="App.checkAnswer()">Check Answer</button>
        <div class="explanation-panel" id="explanationPanel"></div>
    </div>
</div>

<!-- ========== SCORE SCREEN ========== -->
<div class="screen" id="screen-score">
    <div class="score-screen">
        <div class="score-big" id="scoreBig">0%</div>
        <div class="score-label" id="scoreLabel">Score</div>
        <div class="score-details">
            <table>
                <tr><td class="label-col">Correct</td><td class="value-col" id="scoreCorrect">0</td></tr>
                <tr><td class="label-col">Incorrect</td><td class="value-col" id="scoreIncorrect">0</td></tr>
                <tr><td class="label-col">Unanswered</td><td class="value-col" id="scoreUnanswered">0</td></tr>
                <tr><td class="label-col">Total</td><td class="value-col" id="scoreTotal">70</td></tr>
                <tr><td class="label-col">Time</td><td class="value-col" id="scoreTime">00:00:00</td></tr>
            </table>
        </div>
        <div class="category-breakdown" id="categoryBreakdown"></div>
        <div class="score-actions">
            <button style="background:var(--blue)" onclick="App.startReview()">Review Answers</button>
            <button style="background:var(--red)" onclick="App.retakeTest()">Retake</button>
            <button style="background:var(--gray-700)" onclick="showScreen('home')">Home</button>
        </div>
    </div>
</div>

<!-- ========== DRILL SCREEN ========== -->
<div class="screen" id="screen-drill">
    <div class="drill-container">
        <div class="drill-progress" id="drillProgress"></div>
        <div class="drill-card" id="drillCard"></div>
    </div>
</div>

<!-- ========== REVIEW SCREEN ========== -->
<div class="screen" id="screen-review">
    <h2 style="color:var(--navy);margin-bottom:16px">Review All Questions</h2>
    <div class="review-controls">
        <select id="reviewCatFilter" onchange="Review.render()"><option value="">All Categories</option></select>
        <select id="reviewDiffFilter" onchange="Review.render()"><option value="">All Difficulty</option><option value="1">Easy</option><option value="2">Medium</option><option value="3">Hard</option></select>
        <input type="text" id="reviewSearch" placeholder="Search questions..." oninput="Review.render()">
        <button class="btn-nav btn-home" onclick="showScreen('home')">Home</button>
    </div>
    <div id="reviewContent"></div>
</div>

<!-- ========== SETTINGS SCREEN ========== -->
<div class="screen" id="screen-settings">
    <div class="settings-panel">
        <h2>Settings</h2>
        <div class="setting-group">
            <h3>AI Chat - Anthropic (Claude)</h3>
            <div class="setting-row">
                <label>Anthropic API Key</label>
                <input type="password" id="settingAnthropicKey" placeholder="sk-ant-api03-...">
                <div class="hint">Get yours at console.anthropic.com. Stored locally only.</div>
            </div>
            <div class="setting-row">
                <label>Claude Model</label>
                <select id="settingAnthropicModel">
                    <option value="claude-sonnet-4-5-20250929">Claude Sonnet 4.5 (Fast)</option>
                    <option value="claude-haiku-4-5-20251001">Claude Haiku 4.5 (Fastest)</option>
                    <option value="claude-opus-4-5-20251101">Claude Opus 4.5 (Best)</option>
                </select>
            </div>
        </div>
        <div class="setting-group">
            <h3>AI Chat - OpenAI (GPT)</h3>
            <div class="setting-row">
                <label>OpenAI API Key</label>
                <input type="password" id="settingOpenaiKey" placeholder="sk-proj-...">
                <div class="hint">Get yours at platform.openai.com. Stored locally only.</div>
            </div>
            <div class="setting-row">
                <label>OpenAI Model</label>
                <select id="settingOpenaiModel">
                    <option value="gpt-4o-mini">GPT-4o Mini (Fast)</option>
                    <option value="gpt-4o">GPT-4o (Best)</option>
                    <option value="gpt-4.1-mini">GPT-4.1 Mini</option>
                    <option value="gpt-4.1">GPT-4.1</option>
                </select>
            </div>
        </div>
        <div class="setting-group">
            <h3>Active Provider</h3>
            <div class="setting-row">
                <select id="settingProvider">
                    <option value="anthropic">Anthropic (Claude)</option>
                    <option value="openai">OpenAI (GPT)</option>
                </select>
                <div class="hint">Switch between providers anytime. Both keys are saved independently.</div>
            </div>
            <button class="btn-save-settings" onclick="Settings.save()">Save Settings</button>
        </div>
        <div class="setting-group">
            <h3>Data</h3>
            <div class="setting-row">
                <button class="btn-nav" style="background:var(--orange);border-color:var(--orange)" onclick="Settings.clearProgress()">Clear All Progress</button>
                <div class="hint">Removes all test history, drill progress, and stats.</div>
            </div>
            <div class="setting-row">
                <button class="btn-nav btn-home" onclick="showScreen('home')">Back to Home</button>
            </div>
        </div>
    </div>
</div>

<!-- CALCULATOR PANEL -->
<div class="calc-panel" id="calcPanel">
    <div class="calc-header">
        <h4>Calculator</h4>
        <button class="calc-close" onclick="Calc.toggle()">&times;</button>
    </div>
    <div class="calc-display" id="calcDisplay">0</div>
    <div class="calc-buttons">
        <button class="calc-btn clear" onclick="Calc.clear()">C</button>
        <button class="calc-btn" onclick="Calc.input('(')">(</button>
        <button class="calc-btn" onclick="Calc.input(')')">)</button>
        <button class="calc-btn op" onclick="Calc.input('/')">&divide;</button>
        <button class="calc-btn" onclick="Calc.input('7')">7</button>
        <button class="calc-btn" onclick="Calc.input('8')">8</button>
        <button class="calc-btn" onclick="Calc.input('9')">9</button>
        <button class="calc-btn op" onclick="Calc.input('*')">&times;</button>
        <button class="calc-btn" onclick="Calc.input('4')">4</button>
        <button class="calc-btn" onclick="Calc.input('5')">5</button>
        <button class="calc-btn" onclick="Calc.input('6')">6</button>
        <button class="calc-btn op" onclick="Calc.input('-')">-</button>
        <button class="calc-btn" onclick="Calc.input('1')">1</button>
        <button class="calc-btn" onclick="Calc.input('2')">2</button>
        <button class="calc-btn" onclick="Calc.input('3')">3</button>
        <button class="calc-btn op" onclick="Calc.input('+')">+</button>
        <button class="calc-btn" onclick="Calc.input('0')">0</button>
        <button class="calc-btn" onclick="Calc.input('.')">.</button>
        <button class="calc-btn" onclick="Calc.backspace()">&larr;</button>
        <button class="calc-btn eq" onclick="Calc.equals()">=</button>
    </div>
</div>

<!-- TIMER ADJUST MODAL -->
<div class="modal-overlay" id="timerModal">
    <div class="modal" style="max-width:350px">
        <h2>Adjust Timer</h2>
        <div class="setting-row">
            <label>Test Duration (minutes)</label>
            <input type="number" id="timerMinutes" min="1" max="300" value="90">
            <div class="hint">Default: 90 minutes (1.5 hours)</div>
        </div>
        <div class="modal-actions">
            <button class="btn-nav" style="background:var(--gray-500);border-color:var(--gray-500)" onclick="App.hideTimerModal()">Cancel</button>
            <button class="btn-nav" style="background:var(--green);border-color:var(--green)" onclick="App.applyTimerChange()">Apply</button>
        </div>
    </div>
</div>

<!-- FOOTER NAV (exam/practice/review-after-test) -->
<div class="footer-nav" id="footerNav" style="display:none">
    <div class="nav-controls">
        <div class="nav-buttons">
            <div class="toolbar" style="margin-right:8px">
                <button class="tool-btn" id="btnCalc" onclick="Calc.toggle()" title="Calculator">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14h-2v-2h2v2zm0-4h-2V9h2v4zm4 4h-2v-6h2v6zm0-8h-2V7h2v2zm-8 8H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2z"/></svg>
                    Calc
                </button>
                <button class="tool-btn" id="btnAudio" onclick="Audio.speak()" title="Read question aloud">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                    Audio
                </button>
                <button class="tool-btn" id="btnTimerAdj" onclick="App.showTimerModal()" title="Adjust timer">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                    Timer
                </button>
            </div>
            <button class="btn-nav btn-home" onclick="App.exitToHome()">Exit</button>
            <button class="btn-nav" id="btnPrev" onclick="App.prev()" disabled>&laquo; Prev</button>
            <button class="btn-nav" id="btnNext" onclick="App.next()">Next &raquo;</button>
            <button class="btn-nav btn-submit" id="btnSubmit" onclick="App.showSubmitModal()">Submit</button>
        </div>
        <div class="palette-wrap">
            <div class="palette-mini" id="paletteMini"></div>
            <button class="palette-expand-btn" id="paletteExpandBtn" onclick="App.togglePalette()">Show All</button>
            <div class="question-palette collapsed" id="questionPalette"></div>
            <div class="palette-legend" id="paletteLegend" style="display:none">
                <div class="legend-item"><div class="legend-dot lg-current"></div>Current</div>
                <div class="legend-item"><div class="legend-dot lg-answered"></div>Answered</div>
                <div class="legend-item"><div class="legend-dot lg-unanswered"></div>Not Visited</div>
                <div class="legend-item"><div class="legend-dot lg-flagged"></div>Flagged</div>
            </div>
        </div>
    </div>
</div>

<!-- SUBMIT MODAL -->
<div class="modal-overlay" id="submitModal">
    <div class="modal">
        <h2>Submit Test</h2>
        <p>Are you sure you want to submit?</p>
        <table>
            <thead><tr><th>Status</th><th>Count</th></tr></thead>
            <tbody>
                <tr><td>Answered</td><td id="modalAnswered">0</td></tr>
                <tr><td>Unanswered</td><td id="modalUnanswered">0</td></tr>
                <tr><td>Bookmarked</td><td id="modalBookmarked">0</td></tr>
            </tbody>
        </table>
        <div class="modal-actions">
            <button class="btn-nav" style="background:var(--gray-500);border-color:var(--gray-500)" onclick="App.hideSubmitModal()">Cancel</button>
            <button class="btn-nav btn-submit" onclick="App.submitTest()">Submit</button>
        </div>
    </div>
</div>

<!-- AI CHAT -->
<button class="chat-fab" id="chatFab" onclick="Chat.toggle()" title="Ask AI about this question" style="display:none">?</button>
<div class="chat-panel" id="chatPanel">
    <div class="chat-header">
        <h3>AI Tutor</h3>
        <button class="chat-close" onclick="Chat.toggle()">&times;</button>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input-area">
        <input type="text" id="chatInput" placeholder="Ask about this question..." onkeydown="if(event.key==='Enter')Chat.send()">
        <button onclick="Chat.send()">&#9654;</button>
    </div>
</div>

<script>
// =====================================================================
// EMBEDDED FALLBACK BANK DATA (for file:// protocol)
// =====================================================================
let BANK_DATA = null; // Will be set after we try fetch

// =====================================================================
// STORAGE HELPERS
// =====================================================================
const Store = {
    get(k, def) { try { const v = localStorage.getItem('wgu_' + k); return v ? JSON.parse(v) : def; } catch { return def; } },
    set(k, v) { try { localStorage.setItem('wgu_' + k, JSON.stringify(v)); } catch {} },
    remove(k) { try { localStorage.removeItem('wgu_' + k); } catch {} }
};

// =====================================================================
// BANK MANAGER
// =====================================================================
const BankManager = {
    banks: [],
    manifest: [
        { id: 'algebra-fxo1', file: 'banks/algebra-fxo1.json', title: 'Applied Algebra - FXO1', fallback: true }
    ],

    async loadAll() {
        for (const entry of this.manifest) {
            let bank = null;
            try {
                const resp = await fetch(entry.file);
                if (resp.ok) bank = await resp.json();
            } catch {}
            if (!bank && entry.fallback && BANK_DATA) {
                bank = BANK_DATA;
            }
            if (bank) {
                this.banks.push(bank);
            }
        }
        if (this.banks.length === 0 && BANK_DATA) {
            this.banks.push(BANK_DATA);
        }
    },

    getBank(id) {
        return this.banks.find(b => b.bankId === id);
    }
};

// =====================================================================
// SCREEN ROUTER
// =====================================================================
function showScreen(name, showSubheader, showFooter) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    const el = document.getElementById('screen-' + name);
    if (el) el.classList.add('active');
    document.getElementById('subheader').style.display = showSubheader ? '' : 'none';
    document.getElementById('footerNav').style.display = showFooter ? '' : 'none';

    const chatFab = document.getElementById('chatFab');
    if (name === 'exam' || name === 'drill') {
        chatFab.style.display = '';
    } else {
        chatFab.style.display = 'none';
        Chat.close();
    }
}

// =====================================================================
// HOME SCREEN
// =====================================================================
const Home = {
    render() {
        this.renderStats();
        this.renderBanks();
    },

    renderStats() {
        const stats = Store.get('globalStats', { testsCompleted: 0, avgScore: 0, drillStreak: 0, totalStudyMins: 0 });
        const drillData = Store.get('drillProgress', {});
        const totalQ = Object.keys(drillData).length;
        const mastered = Object.values(drillData).filter(d => d.ef >= 2.5 && d.reps >= 3).length;
        const masteryPct = totalQ > 0 ? Math.round((mastered / totalQ) * 100) : 0;

        document.getElementById('homeStats').innerHTML = `
            <div class="stat-card"><div class="stat-val">${stats.testsCompleted}</div><div class="stat-lbl">Tests Taken</div></div>
            <div class="stat-card"><div class="stat-val">${stats.avgScore || 0}%</div><div class="stat-lbl">Avg Score</div></div>
            <div class="stat-card"><div class="stat-val">${masteryPct}%</div><div class="stat-lbl">Mastery</div></div>
            <div class="stat-card"><div class="stat-val">${stats.drillStreak}</div><div class="stat-lbl">Drill Streak</div></div>
        `;
    },

    renderBanks() {
        const el = document.getElementById('bankList');
        if (BankManager.banks.length === 0) {
            el.innerHTML = '<p style="text-align:center;color:var(--gray-600);padding:40px">No question banks loaded. Check that banks/ folder exists.</p>';
            return;
        }
        el.innerHTML = BankManager.banks.map(bank => {
            const history = Store.get('testHistory_' + bank.bankId, []);
            const best = history.length > 0 ? Math.max(...history.map(h => h.pct)) : null;
            return `
            <div class="bank-card">
                <h2>${bank.title}</h2>
                <div class="bank-desc">${bank.description || ''}</div>
                <div class="bank-meta">
                    <span>${bank.questions.length} questions</span>
                    <span>Time: ${Math.floor((bank.timeLimit||5400)/60)} min</span>
                    <span>Pass: ${bank.passingScore||70}%</span>
                    ${best !== null ? `<span>Best: <strong>${best}%</strong></span>` : ''}
                </div>
                <div class="mode-buttons">
                    <button class="mode-btn m-test" onclick="App.start('${bank.bankId}','test')">
                        <h3>Test Mode</h3><p>Timed, Cengage-style. No feedback until submit.</p>
                    </button>
                    <button class="mode-btn m-practice" onclick="App.start('${bank.bankId}','practice')">
                        <h3>Practice Mode</h3><p>Check each answer. See explanations instantly.</p>
                    </button>
                    <button class="mode-btn m-drill" onclick="Drill.start('${bank.bankId}')">
                        <h3>Drill Mode</h3><p>Spaced repetition. Focus on weak spots.</p>
                    </button>
                    <button class="mode-btn m-review" onclick="Review.start('${bank.bankId}')">
                        <h3>Review Mode</h3><p>Browse all questions with answers.</p>
                    </button>
                </div>
            </div>`;
        }).join('');
    }
};

// =====================================================================
// MAIN APP (Test & Practice Engine)
// =====================================================================
const App = {
    bank: null,
    questions: [],
    mode: 'test', // 'test' | 'practice' | 'review-after'
    currentQ: 0,
    answers: {},
    bookmarked: {},
    visited: {},
    practiceChecked: {},  // { qIndex: true } for practice mode
    practiceResults: {},  // { qIndex: 'correct'|'incorrect'|'skipped' }
    timerSeconds: 0,
    timerInterval: null,
    timerVisible: true,
    countdown: true,
    submitted: false,
    startTime: 0,

    start(bankId, mode) {
        this.bank = BankManager.getBank(bankId);
        if (!this.bank) return;
        this.questions = [...this.bank.questions];
        this.mode = mode;
        this.currentQ = 0;
        this.answers = {};
        this.bookmarked = {};
        this.visited = { 0: true };
        this.practiceChecked = {};
        this.practiceResults = {};
        this.submitted = false;
        this.startTime = Date.now();

        // Timer setup
        if (mode === 'test') {
            this.countdown = true;
            this.timerSeconds = this.bank.timeLimit || 5400;
        } else {
            this.countdown = false;
            this.timerSeconds = 0;
        }

        // Reset metrics and start tracking first question
        Metrics.reset();
        Metrics.startQuestion(0);

        // UI
        document.getElementById('testNameBar').innerHTML = this.bank.title;
        document.getElementById('modeTab').textContent = mode === 'test' ? 'Test Mode' : 'Practice Mode';
        document.getElementById('btnSubmit').style.display = mode === 'test' ? '' : 'none';
        document.getElementById('btnCheck').style.display = mode === 'practice' ? '' : 'none';

        this.buildPalette();
        showScreen('exam', true, true);
        this.renderQuestion();
        this.startTimer();

        // Chat context
        Chat.clearHistory();
        document.getElementById('chatFab').classList.add('has-context');
    },

    paletteExpanded: false,

    buildPalette() {
        const pal = document.getElementById('questionPalette');
        pal.innerHTML = '';
        for (let i = 0; i < this.questions.length; i++) {
            const btn = document.createElement('div');
            btn.className = 'q-num';
            btn.textContent = i + 1;
            btn.onclick = () => this.goTo(i);
            btn.id = 'qp-' + i;
            pal.appendChild(btn);
        }
        this.paletteExpanded = false;
        document.getElementById('questionPalette').className = 'question-palette collapsed';
        document.getElementById('paletteLegend').style.display = 'none';
        document.getElementById('paletteExpandBtn').textContent = 'Show All';
    },

    buildMiniPalette() {
        const mini = document.getElementById('paletteMini');
        const cur = this.currentQ;
        const total = this.questions.length;
        let html = '';

        // Show: current + next 5, then ... [70]
        const show = [];
        for (let i = cur; i < Math.min(cur + 6, total); i++) show.push(i);

        // Add last question if not already shown
        const lastIdx = total - 1;
        const showsLast = show.includes(lastIdx);

        for (let i = 0; i < show.length; i++) {
            const idx = show[i];
            const cls = this._getPaletteClass(idx);
            html += `<div class="q-num ${cls}" onclick="App.goTo(${idx})">${idx + 1}</div>`;
        }

        if (!showsLast) {
            html += '<span class="pm-ellipsis">...</span>';
            const cls = this._getPaletteClass(lastIdx);
            html += `<div class="q-num ${cls}" onclick="App.goTo(${lastIdx})">${total}</div>`;
        }

        mini.innerHTML = html;
    },

    _getPaletteClass(i) {
        let cls = '';
        if (this.mode === 'practice' && this.practiceResults[i]) {
            cls = 'p-' + this.practiceResults[i];
        } else if (i === this.currentQ) {
            cls = 'current';
        } else if (this.answers[i] !== undefined) {
            cls = 'answered';
        } else if (this.visited[i]) {
            cls = 'visited';
        }
        if (this.bookmarked[i]) cls += ' flagged';
        return cls;
    },

    togglePalette() {
        this.paletteExpanded = !this.paletteExpanded;
        document.getElementById('questionPalette').className = 'question-palette ' + (this.paletteExpanded ? 'expanded' : 'collapsed');
        document.getElementById('paletteLegend').style.display = this.paletteExpanded ? '' : 'none';
        document.getElementById('paletteExpandBtn').textContent = this.paletteExpanded ? 'Hide' : 'Show All';
    },

    renderQuestion() {
        const q = this.questions[this.currentQ];
        document.getElementById('questionNumber').textContent = `Question ${this.currentQ + 1} of ${this.questions.length}`;
        document.getElementById('questionText').innerHTML = q.text.replace(/\n/g, '<br>');

        const list = document.getElementById('optionsList');
        list.innerHTML = '';
        const isChecked = this.practiceChecked[this.currentQ];
        const isReview = this.mode === 'review-after';

        q.options.forEach((opt, i) => {
            const li = document.createElement('li');
            let cls = 'option-item';
            if (this.answers[this.currentQ] === i) cls += ' selected';

            if (isReview || isChecked) {
                if (i === q.correctAnswer) cls += ' correct-answer';
                if (this.answers[this.currentQ] === i && i !== q.correctAnswer) cls += ' wrong-answer';
            }

            li.className = cls;
            const disabled = this.submitted || isChecked || isReview;
            li.innerHTML = `<input type="radio" name="q${this.currentQ}" value="${i}" ${this.answers[this.currentQ]===i?'checked':''} ${disabled?'disabled':''}>
                <span class="option-label">${opt}</span>`;
            if (!disabled) {
                li.onclick = () => this.selectOption(i);
            }
            list.appendChild(li);
        });

        // Practice check button
        const btnCheck = document.getElementById('btnCheck');
        if (this.mode === 'practice') {
            btnCheck.style.display = isChecked ? 'none' : '';
            btnCheck.disabled = this.answers[this.currentQ] === undefined;
        } else {
            btnCheck.style.display = 'none';
        }

        // Explanation panel
        const expPanel = document.getElementById('explanationPanel');
        if ((isChecked || isReview) && q.explanation) {
            const isCorrect = this.answers[this.currentQ] === q.correctAnswer;
            expPanel.className = 'explanation-panel show' + (isCorrect ? '' : ' incorrect');
            expPanel.innerHTML = `<h4>${isCorrect ? 'Correct!' : (this.answers[this.currentQ] !== undefined ? 'Incorrect' : 'Not answered')}</h4><p>${q.explanation}</p>`;
        } else {
            expPanel.className = 'explanation-panel';
        }

        // Bookmark button
        const bmBtn = document.getElementById('btnBookmark');
        bmBtn.className = 'btn-bookmark' + (this.bookmarked[this.currentQ] ? ' flagged' : '');
        bmBtn.textContent = this.bookmarked[this.currentQ] ? 'Bookmarked' : 'Bookmark';

        // Nav buttons
        document.getElementById('btnPrev').disabled = this.currentQ === 0;

        this.updatePalette();
        this.renderMath();
    },

    selectOption(i) {
        if (this.submitted || this.practiceChecked[this.currentQ]) return;
        this.answers[this.currentQ] = i;
        this.renderQuestion();
    },

    clearAnswer() {
        if (this.submitted || this.practiceChecked[this.currentQ]) return;
        delete this.answers[this.currentQ];
        this.renderQuestion();
    },

    toggleBookmark() {
        this.bookmarked[this.currentQ] = !this.bookmarked[this.currentQ];
        if (!this.bookmarked[this.currentQ]) delete this.bookmarked[this.currentQ];
        this.renderQuestion();
    },

    checkAnswer() {
        if (this.answers[this.currentQ] === undefined) return;
        this.practiceChecked[this.currentQ] = true;
        const q = this.questions[this.currentQ];
        this.practiceResults[this.currentQ] = this.answers[this.currentQ] === q.correctAnswer ? 'correct' : 'incorrect';
        this.renderQuestion();
    },

    goTo(idx) {
        // Track time on current question before switching
        Metrics.endQuestion(this.currentQ);
        this.currentQ = idx;
        this.visited[idx] = true;
        // Start tracking time on new question
        Metrics.startQuestion(idx);
        this.renderQuestion();
        document.getElementById('questionContainer').scrollIntoView({ behavior: 'smooth', block: 'start' });
    },

    prev() { if (this.currentQ > 0) this.goTo(this.currentQ - 1); },
    next() { if (this.currentQ < this.questions.length - 1) this.goTo(this.currentQ + 1); },

    updatePalette() {
        // Update full palette
        for (let i = 0; i < this.questions.length; i++) {
            const el = document.getElementById('qp-' + i);
            if (!el) continue;
            el.className = 'q-num ' + this._getPaletteClass(i);
        }
        // Update mini palette
        this.buildMiniPalette();
    },

    // Timer
    startTimer() {
        this.stopTimer();
        this.timerVisible = true;
        document.getElementById('timerDisplay').style.visibility = 'visible';
        document.getElementById('timerToggle').textContent = 'Hide Timer';
        this.updateTimerDisplay();
        this.timerInterval = setInterval(() => {
            if (this.countdown) {
                this.timerSeconds--;
                if (this.timerSeconds <= 300) {
                    document.getElementById('timerDisplay').classList.add('warning');
                }
                if (this.timerSeconds <= 0) {
                    this.timerSeconds = 0;
                    this.submitTest();
                    return;
                }
            } else {
                this.timerSeconds++;
            }
            this.updateTimerDisplay();
        }, 1000);
    },

    stopTimer() {
        if (this.timerInterval) clearInterval(this.timerInterval);
        this.timerInterval = null;
        document.getElementById('timerDisplay').classList.remove('warning');
    },

    updateTimerDisplay() {
        const s = this.timerSeconds;
        const h = Math.floor(s / 3600);
        const m = Math.floor((s % 3600) / 60);
        const sec = s % 60;
        document.getElementById('timerDisplay').textContent =
            `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
    },

    toggleTimer() {
        this.timerVisible = !this.timerVisible;
        document.getElementById('timerDisplay').style.visibility = this.timerVisible ? 'visible' : 'hidden';
        document.getElementById('timerToggle').textContent = this.timerVisible ? 'Hide Timer' : 'Show Timer';
    },

    // Submit
    showSubmitModal() {
        const answered = Object.keys(this.answers).length;
        document.getElementById('modalAnswered').textContent = answered;
        document.getElementById('modalUnanswered').textContent = this.questions.length - answered;
        document.getElementById('modalBookmarked').textContent = Object.keys(this.bookmarked).length;
        document.getElementById('submitModal').classList.add('active');
    },

    hideSubmitModal() {
        document.getElementById('submitModal').classList.remove('active');
    },

    submitTest() {
        this.hideSubmitModal();
        this.submitted = true;
        this.stopTimer();
        Audio.stop();
        Metrics.endQuestion(this.currentQ);

        let correct = 0;
        const catScores = {};
        this.questions.forEach((q, i) => {
            const cat = q.category || 'General';
            if (!catScores[cat]) catScores[cat] = { correct: 0, total: 0 };
            catScores[cat].total++;
            if (this.answers[i] === q.correctAnswer) {
                correct++;
                catScores[cat].correct++;
            }
        });

        const total = this.questions.length;
        const answered = Object.keys(this.answers).length;
        const pct = Math.round((correct / total) * 1000) / 10;
        const pass = pct >= (this.bank.passingScore || 70);
        const elapsed = Math.round((Date.now() - this.startTime) / 1000);
        const timeStr = this.mode === 'test'
            ? this.formatTime((this.bank.timeLimit || 5400) - this.timerSeconds)
            : this.formatTime(elapsed);

        // Score display
        document.getElementById('scoreBig').textContent = pct + '%';
        document.getElementById('scoreBig').className = 'score-big ' + (pass ? 'pass' : 'fail');
        document.getElementById('scoreLabel').textContent = pass ? 'PASS' : 'NOT YET';
        document.getElementById('scoreCorrect').textContent = correct;
        document.getElementById('scoreIncorrect').textContent = answered - correct;
        document.getElementById('scoreUnanswered').textContent = total - answered;
        document.getElementById('scoreTotal').textContent = total;
        document.getElementById('scoreTime').textContent = timeStr;

        // Category breakdown
        const catHtml = Object.entries(catScores).map(([cat, d]) => {
            const p = Math.round((d.correct / d.total) * 100);
            const cls = p >= 70 ? 'good' : p >= 50 ? 'warn' : 'bad';
            return `<div class="cat-row"><span style="min-width:160px">${cat}</span><div class="cat-bar"><div class="cat-fill ${cls}" style="width:${p}%"></div></div><span style="min-width:60px;text-align:right">${d.correct}/${d.total} (${p}%)</span></div>`;
        }).join('');
        document.getElementById('categoryBreakdown').innerHTML = '<h3>Category Breakdown</h3>' + catHtml + Metrics.buildMetricsSummary(this.questions, this.answers);

        // Save history
        const history = Store.get('testHistory_' + this.bank.bankId, []);
        history.push({ date: new Date().toISOString(), pct, correct, total, time: timeStr, mode: this.mode });
        Store.set('testHistory_' + this.bank.bankId, history);

        // Update global stats
        const stats = Store.get('globalStats', { testsCompleted: 0, avgScore: 0, drillStreak: 0, totalStudyMins: 0 });
        stats.testsCompleted++;
        stats.avgScore = Math.round(((stats.avgScore * (stats.testsCompleted - 1)) + pct) / stats.testsCompleted);
        Store.set('globalStats', stats);

        showScreen('score', false, false);
    },

    startReview() {
        this.mode = 'review-after';
        this.currentQ = 0;
        document.getElementById('btnSubmit').style.display = 'none';
        document.getElementById('btnCheck').style.display = 'none';
        document.getElementById('modeTab').textContent = 'Review';
        showScreen('exam', true, true);
        this.renderQuestion();
    },

    retakeTest() {
        if (this.bank) this.start(this.bank.bankId, 'test');
    },

    exitToHome() {
        this.stopTimer();
        Audio.stop();
        Metrics.endQuestion(this.currentQ);
        if (!this.submitted && this.mode === 'test' && Object.keys(this.answers).length > 0) {
            if (!confirm('Leave without submitting? Your progress will be lost.')) return;
        }
        showScreen('home');
        Home.render();
    },

    // Timer adjustment modal
    showTimerModal() {
        const mins = Math.floor(this.timerSeconds / 60);
        document.getElementById('timerMinutes').value = mins;
        document.getElementById('timerModal').classList.add('active');
    },

    hideTimerModal() {
        document.getElementById('timerModal').classList.remove('active');
    },

    applyTimerChange() {
        const mins = parseInt(document.getElementById('timerMinutes').value) || 90;
        this.timerSeconds = mins * 60;
        this.updateTimerDisplay();
        this.hideTimerModal();
    },

    formatTime(s) {
        const h = Math.floor(s / 3600);
        const m = Math.floor((s % 3600) / 60);
        const sec = s % 60;
        return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
    },

    renderMath() {
        if (window.renderMathInElement) {
            try {
                renderMathInElement(document.getElementById('questionContainer'), {
                    delimiters: [
                        { left: "\\[", right: "\\]", display: true },
                        { left: "\\(", right: "\\)", display: false },
                        { left: "$$", right: "$$", display: true },
                        { left: "$", right: "$", display: false },
                    ]
                });
            } catch {}
        }
    },

    // Get current question context for chat
    getQuestionContext() {
        if (!this.questions[this.currentQ]) return null;
        const q = this.questions[this.currentQ];
        return {
            number: this.currentQ + 1,
            text: q.text,
            options: q.options,
            correctAnswer: q.correctAnswer,
            correctText: q.options[q.correctAnswer],
            explanation: q.explanation,
            userAnswer: this.answers[this.currentQ],
            userAnswerText: this.answers[this.currentQ] !== undefined ? q.options[this.answers[this.currentQ]] : null
        };
    }
};

// =====================================================================
// DRILL MODE (SM-2 Spaced Repetition)
// =====================================================================
const Drill = {
    bank: null,
    queue: [],
    current: null,
    sessionCount: 0,
    sessionCorrect: 0,
    showingAnswer: false,
    questionStart: 0,
    SESSION_LIMIT: 20,

    start(bankId) {
        this.bank = BankManager.getBank(bankId);
        if (!this.bank) return;
        this.sessionCount = 0;
        this.sessionCorrect = 0;
        this.buildQueue();

        if (this.queue.length === 0) {
            showScreen('drill', false, false);
            document.getElementById('drillCard').innerHTML = `
                <div class="drill-session-done">
                    <h2>All caught up!</h2>
                    <p>No questions due for review right now.</p>
                    <button class="btn-nav" style="margin-top:20px" onclick="showScreen('home');Home.render()">Home</button>
                </div>`;
            document.getElementById('drillProgress').textContent = '';
            document.getElementById('chatFab').style.display = '';
            return;
        }

        showScreen('drill', false, false);
        document.getElementById('chatFab').style.display = '';
        Chat.clearHistory();
        this.nextCard();
    },

    getProgress(qId) {
        const all = Store.get('drillProgress', {});
        return all[qId] || { ef: 2.5, interval: 0, reps: 0, nextReview: 0 };
    },

    saveProgress(qId, data) {
        const all = Store.get('drillProgress', {});
        all[qId] = data;
        Store.set('drillProgress', all);
    },

    buildQueue() {
        const now = Date.now();
        const scored = this.bank.questions.map(q => {
            const p = this.getProgress(q.id);
            let priority = 0;
            if (p.nextReview && p.nextReview <= now) priority = 3; // overdue
            else if (p.reps === 0) priority = 2; // never seen
            else if (p.ef < 2.0) priority = 1; // low ease
            else priority = 0; // not due
            return { question: q, progress: p, priority };
        }).filter(s => s.priority > 0)
          .sort((a, b) => b.priority - a.priority || a.progress.ef - b.progress.ef);

        this.queue = scored.slice(0, this.SESSION_LIMIT);
    },

    nextCard() {
        if (this.queue.length === 0 || this.sessionCount >= this.SESSION_LIMIT) {
            this.showSessionDone();
            return;
        }

        this.current = this.queue.shift();
        this.showingAnswer = false;
        this.questionStart = Date.now();

        const dueCount = this.queue.length + 1;
        document.getElementById('drillProgress').innerHTML =
            `<span class="due-count">${dueCount}</span> questions remaining | ${this.sessionCount} completed (${this.sessionCorrect} correct)`;

        const q = this.current.question;
        document.getElementById('drillCard').innerHTML = `
            <div class="question-text">${q.text.replace(/\n/g, '<br>')}</div>
            <ul class="options-list" id="drillOptions">
                ${q.options.map((opt, i) => `
                    <li class="option-item" onclick="Drill.selectOption(${i})" id="dropt-${i}">
                        <input type="radio" name="drill" value="${i}">
                        <span class="option-label">${opt}</span>
                    </li>
                `).join('')}
            </ul>
            <div class="drill-answer" id="drillAnswer">
                <div class="correct-label" id="drillResultLabel"></div>
                <div class="explanation">${q.explanation || ''}</div>
                <div class="drill-buttons">
                    <button class="drill-btn btn-missed" onclick="Drill.rate(1)">Missed it (1)</button>
                    <button class="drill-btn btn-struggled" onclick="Drill.rate(3)">Struggled (3)</button>
                    <button class="drill-btn btn-got-it" onclick="Drill.rate(5)">Got it! (5)</button>
                </div>
            </div>
            <div style="text-align:center;margin-top:16px">
                <button class="drill-btn btn-show" id="drillShowBtn" onclick="Drill.showAnswer()">Show Answer</button>
            </div>
        `;

        // Update chat context
        document.getElementById('chatFab').classList.add('has-context');
        this.renderMath();
    },

    selectedOption: null,

    selectOption(i) {
        if (this.showingAnswer) return;
        this.selectedOption = i;
        document.querySelectorAll('#drillOptions .option-item').forEach((el, idx) => {
            el.className = 'option-item' + (idx === i ? ' selected' : '');
        });
    },

    showAnswer() {
        this.showingAnswer = true;
        const q = this.current.question;

        // Highlight correct/wrong
        q.options.forEach((_, i) => {
            const el = document.getElementById('dropt-' + i);
            if (i === q.correctAnswer) el.classList.add('correct-answer');
            if (this.selectedOption === i && i !== q.correctAnswer) el.classList.add('wrong-answer');
        });

        const isCorrect = this.selectedOption === q.correctAnswer;
        document.getElementById('drillResultLabel').textContent = isCorrect ? 'Correct!' : (this.selectedOption !== null ? 'Incorrect' : 'Not answered');
        document.getElementById('drillResultLabel').style.color = isCorrect ? 'var(--green)' : 'var(--red)';
        document.getElementById('drillAnswer').classList.add('show');
        document.getElementById('drillShowBtn').style.display = 'none';
    },

    rate(quality) {
        const q = this.current.question;
        const p = this.current.progress;

        // SM-2 algorithm
        let ef = p.ef + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
        if (ef < 1.3) ef = 1.3;

        let interval, reps;
        if (quality < 3) {
            reps = 0;
            interval = 1;
        } else {
            reps = p.reps + 1;
            if (reps === 1) interval = 1;
            else if (reps === 2) interval = 6;
            else interval = Math.round(p.interval * ef);
        }

        const nextReview = Date.now() + interval * 86400000;
        this.saveProgress(q.id, { ef, interval, reps, nextReview });

        this.sessionCount++;
        if (this.selectedOption === q.correctAnswer) this.sessionCorrect++;

        // Update streak
        const stats = Store.get('globalStats', { testsCompleted: 0, avgScore: 0, drillStreak: 0, totalStudyMins: 0 });
        if (quality >= 3) stats.drillStreak++;
        else stats.drillStreak = 0;
        Store.set('globalStats', stats);

        this.nextCard();
    },

    showSessionDone() {
        document.getElementById('drillProgress').textContent = '';
        document.getElementById('drillCard').innerHTML = `
            <div class="drill-session-done">
                <h2>Session Complete!</h2>
                <p>${this.sessionCount} questions reviewed</p>
                <p>${this.sessionCorrect} correct (${this.sessionCount > 0 ? Math.round(this.sessionCorrect/this.sessionCount*100) : 0}%)</p>
                <div style="margin-top:20px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
                    <button class="drill-btn btn-show" onclick="Drill.start('${this.bank.bankId}')">Drill Again</button>
                    <button class="btn-nav btn-home" onclick="showScreen('home');Home.render()">Home</button>
                </div>
            </div>`;
    },

    renderMath() {
        if (window.renderMathInElement) {
            try {
                renderMathInElement(document.getElementById('drillCard'), {
                    delimiters: [
                        { left: "\\[", right: "\\]", display: true },
                        { left: "\\(", right: "\\)", display: false },
                        { left: "$$", right: "$$", display: true },
                        { left: "$", right: "$", display: false },
                    ]
                });
            } catch {}
        }
    },

    getQuestionContext() {
        if (!this.current) return null;
        const q = this.current.question;
        return {
            number: q.id,
            text: q.text,
            options: q.options,
            correctAnswer: q.correctAnswer,
            correctText: q.options[q.correctAnswer],
            explanation: q.explanation,
            userAnswer: this.selectedOption,
            userAnswerText: this.selectedOption !== null ? q.options[this.selectedOption] : null
        };
    }
};

// =====================================================================
// REVIEW MODE
// =====================================================================
const Review = {
    bank: null,

    start(bankId) {
        this.bank = BankManager.getBank(bankId);
        if (!this.bank) return;

        // Populate category filter
        const cats = [...new Set(this.bank.questions.map(q => q.category || 'General'))];
        const catSelect = document.getElementById('reviewCatFilter');
        catSelect.innerHTML = '<option value="">All Categories</option>' + cats.map(c => `<option value="${c}">${c}</option>`).join('');
        document.getElementById('reviewSearch').value = '';
        document.getElementById('reviewDiffFilter').value = '';

        showScreen('review');
        this.render();
    },

    render() {
        if (!this.bank) return;
        const catFilter = document.getElementById('reviewCatFilter').value;
        const diffFilter = document.getElementById('reviewDiffFilter').value;
        const search = document.getElementById('reviewSearch').value.toLowerCase();

        let filtered = this.bank.questions.filter(q => {
            if (catFilter && (q.category || 'General') !== catFilter) return false;
            if (diffFilter && String(q.difficulty) !== diffFilter) return false;
            if (search && !q.text.toLowerCase().includes(search) && !q.options.some(o => o.toLowerCase().includes(search))) return false;
            return true;
        });

        // Group by category
        const groups = {};
        filtered.forEach(q => {
            const cat = q.category || 'General';
            if (!groups[cat]) groups[cat] = [];
            groups[cat].push(q);
        });

        const drillData = Store.get('drillProgress', {});
        const diffLabels = { 1: 'Easy', 2: 'Medium', 3: 'Hard' };

        let html = '';
        Object.entries(groups).forEach(([cat, questions]) => {
            html += `<div class="review-category">
                <h3 onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display==='none'?'block':'none';this.querySelector('.toggle-arrow').classList.toggle('collapsed')">
                    ${cat} (${questions.length})
                    <span class="toggle-arrow">&#9660;</span>
                </h3>
                <div>`;
            questions.forEach(q => {
                const mastery = drillData[q.id];
                const masteryLabel = mastery ? (mastery.ef >= 2.5 && mastery.reps >= 3 ? 'Mastered' : mastery.reps > 0 ? 'Learning' : 'New') : 'New';
                html += `<div class="review-q">
                    <div class="rq-text"><strong>Q${q.id}.</strong> ${q.text.replace(/\n/g, '<br>')}</div>
                    <ul class="rq-options">
                        ${q.options.map((opt, i) => `<li class="rq-opt ${i === q.correctAnswer ? 'rq-correct' : ''}">${String.fromCharCode(65+i)}. ${opt}</li>`).join('')}
                    </ul>
                    ${q.explanation ? `<div class="rq-explanation">${q.explanation}</div>` : ''}
                    <div class="rq-meta">
                        <span class="rq-tag">${diffLabels[q.difficulty] || 'Medium'}</span>
                        <span class="rq-tag">${masteryLabel}</span>
                        ${(q.tags || []).map(t => `<span class="rq-tag">${t}</span>`).join('')}
                    </div>
                </div>`;
            });
            html += '</div></div>';
        });

        if (html === '') html = '<p style="text-align:center;color:var(--gray-600);padding:40px">No questions match your filters.</p>';
        document.getElementById('reviewContent').innerHTML = html;

        // Render math
        if (window.renderMathInElement) {
            try {
                renderMathInElement(document.getElementById('reviewContent'), {
                    delimiters: [
                        { left: "\\[", right: "\\]", display: true },
                        { left: "\\(", right: "\\)", display: false },
                        { left: "$$", right: "$$", display: true },
                        { left: "$", right: "$", display: false },
                    ]
                });
            } catch {}
        }
    }
};

// =====================================================================
// SETTINGS
// =====================================================================
const Settings = {
    load() {
        document.getElementById('settingAnthropicKey').value = Store.get('anthropicKey', '');
        document.getElementById('settingAnthropicModel').value = Store.get('anthropicModel', 'claude-sonnet-4-5-20250929');
        document.getElementById('settingOpenaiKey').value = Store.get('openaiKey', '');
        document.getElementById('settingOpenaiModel').value = Store.get('openaiModel', 'gpt-4o-mini');
        document.getElementById('settingProvider').value = Store.get('provider', 'anthropic');
    },
    save() {
        Store.set('anthropicKey', document.getElementById('settingAnthropicKey').value.trim());
        Store.set('anthropicModel', document.getElementById('settingAnthropicModel').value);
        Store.set('openaiKey', document.getElementById('settingOpenaiKey').value.trim());
        Store.set('openaiModel', document.getElementById('settingOpenaiModel').value);
        Store.set('provider', document.getElementById('settingProvider').value);
        alert('Settings saved!');
    },
    clearProgress() {
        if (!confirm('Clear ALL progress data? This cannot be undone.')) return;
        const keysToRemove = [];
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith('wgu_')) keysToRemove.push(key);
        }
        keysToRemove.forEach(k => localStorage.removeItem(k));
        // Preserve API keys
        Settings.load(); // reload from DOM before clearing
        const ak = document.getElementById('settingAnthropicKey').value;
        const ok = document.getElementById('settingOpenaiKey').value;
        if (ak) Store.set('anthropicKey', ak);
        if (ok) Store.set('openaiKey', ok);
        Store.set('provider', document.getElementById('settingProvider').value);
        alert('All progress cleared.');
        Home.render();
    }
};

// =====================================================================
// AI CHAT
// =====================================================================
const Chat = {
    history: [],
    isOpen: false,

    toggle() {
        this.isOpen = !this.isOpen;
        document.getElementById('chatPanel').classList.toggle('open', this.isOpen);
        document.getElementById('chatFab').style.display = this.isOpen ? 'none' : '';
        if (this.isOpen && this.history.length === 0) {
            this.addMessage('system', 'Ask me anything about the current question. I can explain concepts, walk through solutions, or clarify options.');
        }
    },

    close() {
        this.isOpen = false;
        document.getElementById('chatPanel').classList.remove('open');
    },

    clearHistory() {
        this.history = [];
        document.getElementById('chatMessages').innerHTML = '';
    },

    addMessage(role, content) {
        const div = document.createElement('div');
        div.className = 'chat-msg ' + role;
        div.textContent = content;
        document.getElementById('chatMessages').appendChild(div);
        document.getElementById('chatMessages').scrollTop = 999999;
    },

    async send() {
        const input = document.getElementById('chatInput');
        const text = input.value.trim();
        if (!text) return;
        input.value = '';

        const provider = Store.get('provider', 'anthropic');
        const apiKey = provider === 'openai' ? Store.get('openaiKey', '') : Store.get('anthropicKey', '');
        if (!apiKey) {
            this.addMessage('system', `Please set your ${provider === 'openai' ? 'OpenAI' : 'Anthropic'} API key in Settings first.`);
            return;
        }

        this.addMessage('user', text);

        // Build context
        let ctx = App.getQuestionContext() || Drill.getQuestionContext();
        let systemPrompt = 'You are a WGU tutor helping a student study for their algebra assessment. Be concise and clear. Use simple language. If the student asks about a specific question, reference the question context provided.';

        if (ctx) {
            systemPrompt += `\n\nCurrent question (#${ctx.number}):\n"${ctx.text}"\n\nOptions:\n${ctx.options.map((o, i) => `${String.fromCharCode(65+i)}. ${o}`).join('\n')}\n\nCorrect answer: ${String.fromCharCode(65+ctx.correctAnswer)}. ${ctx.correctText}`;
            if (ctx.explanation) systemPrompt += `\n\nExplanation: ${ctx.explanation}`;
            if (ctx.userAnswer !== undefined && ctx.userAnswer !== null) {
                systemPrompt += `\n\nStudent selected: ${String.fromCharCode(65+ctx.userAnswer)}. ${ctx.userAnswerText}`;
            }
        }

        this.history.push({ role: 'user', content: text });
        const messages = this.history.slice(-20);

        try {
            this.addMessage('assistant', 'Thinking...');
            const lastMsg = document.getElementById('chatMessages').lastChild;

            let reply;
            if (provider === 'openai') {
                reply = await this._sendOpenAI(apiKey, systemPrompt, messages);
            } else {
                reply = await this._sendAnthropic(apiKey, systemPrompt, messages);
            }

            lastMsg.textContent = reply;
            this.history.push({ role: 'assistant', content: reply });
        } catch (err) {
            const msgs = document.getElementById('chatMessages');
            if (msgs.lastChild) {
                msgs.lastChild.textContent = err.message || 'Connection error. Check your API key and internet.';
                msgs.lastChild.className = 'chat-msg system';
            }
        }
    },

    async _sendAnthropic(apiKey, systemPrompt, messages) {
        const model = Store.get('anthropicModel', 'claude-sonnet-4-5-20250929');
        const resp = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'x-api-key': apiKey,
                'anthropic-version': '2023-06-01',
                'anthropic-dangerous-direct-browser-access': 'true'
            },
            body: JSON.stringify({ model, max_tokens: 1024, system: systemPrompt, messages })
        });
        if (!resp.ok) {
            const err = await resp.json().catch(() => ({}));
            throw new Error(`Claude error: ${err.error?.message || resp.statusText}`);
        }
        const data = await resp.json();
        return data.content?.[0]?.text || 'No response';
    },

    async _sendOpenAI(apiKey, systemPrompt, messages) {
        const model = Store.get('openaiModel', 'gpt-4o-mini');
        const oaiMessages = [{ role: 'system', content: systemPrompt }, ...messages];
        const resp = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + apiKey
            },
            body: JSON.stringify({ model, max_tokens: 1024, messages: oaiMessages })
        });
        if (!resp.ok) {
            const err = await resp.json().catch(() => ({}));
            throw new Error(`OpenAI error: ${err.error?.message || resp.statusText}`);
        }
        const data = await resp.json();
        return data.choices?.[0]?.message?.content || 'No response';
    }
};

// =====================================================================
// CALCULATOR
// =====================================================================
const Calc = {
    isOpen: false,
    expr: '',

    toggle() {
        this.isOpen = !this.isOpen;
        document.getElementById('calcPanel').classList.toggle('open', this.isOpen);
        document.getElementById('btnCalc').classList.toggle('active', this.isOpen);
    },

    clear() {
        this.expr = '';
        document.getElementById('calcDisplay').textContent = '0';
    },

    input(val) {
        this.expr += val;
        document.getElementById('calcDisplay').textContent = this.expr || '0';
    },

    backspace() {
        this.expr = this.expr.slice(0, -1);
        document.getElementById('calcDisplay').textContent = this.expr || '0';
    },

    equals() {
        try {
            // Safe eval using Function constructor
            const sanitized = this.expr.replace(/[^0-9+\-*/().]/g, '');
            const result = Function('"use strict"; return (' + sanitized + ')')();
            const rounded = Math.round(result * 1000000) / 1000000;
            document.getElementById('calcDisplay').textContent = rounded;
            this.expr = String(rounded);
        } catch {
            document.getElementById('calcDisplay').textContent = 'Error';
            this.expr = '';
        }
    }
};

// =====================================================================
// AUDIO (Text-to-Speech)
// =====================================================================
const Audio = {
    speaking: false,

    speak() {
        if (!('speechSynthesis' in window)) {
            alert('Text-to-speech not supported in this browser.');
            return;
        }

        if (this.speaking) {
            speechSynthesis.cancel();
            this.speaking = false;
            document.getElementById('btnAudio').classList.remove('active');
            return;
        }

        // Get current question text
        let text = '';
        const screen = document.getElementById('screen-exam');
        if (screen.classList.contains('active')) {
            const q = App.questions[App.currentQ];
            if (q) {
                text = `Question ${App.currentQ + 1}. ${this._cleanText(q.text)}. `;
                text += 'Options: ';
                q.options.forEach((opt, i) => {
                    text += `${String.fromCharCode(65 + i)}: ${this._cleanText(opt)}. `;
                });
            }
        } else if (document.getElementById('screen-drill').classList.contains('active') && Drill.current) {
            const q = Drill.current.question;
            text = `${this._cleanText(q.text)}. Options: `;
            q.options.forEach((opt, i) => {
                text += `${String.fromCharCode(65 + i)}: ${this._cleanText(opt)}. `;
            });
        }

        if (!text) {
            alert('No question to read.');
            return;
        }

        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = 0.95;
        utterance.pitch = 1;
        utterance.onend = () => {
            this.speaking = false;
            document.getElementById('btnAudio').classList.remove('active');
        };
        utterance.onerror = () => {
            this.speaking = false;
            document.getElementById('btnAudio').classList.remove('active');
        };

        this.speaking = true;
        document.getElementById('btnAudio').classList.add('active');
        speechSynthesis.speak(utterance);
    },

    _cleanText(text) {
        // Remove HTML tags and simplify for speech
        return text
            .replace(/<[^>]*>/g, '')
            .replace(/\[Graph[^\]]*\]/gi, 'See the graph provided.')
            .replace(/\$/g, ' dollars ')
            .replace(/\n/g, '. ')
            .trim();
    },

    stop() {
        if (this.speaking) {
            speechSynthesis.cancel();
            this.speaking = false;
            const btn = document.getElementById('btnAudio');
            if (btn) btn.classList.remove('active');
        }
    }
};

// =====================================================================
// METRICS TRACKING
// =====================================================================
const Metrics = {
    questionTimes: {},  // { qIndex: { start, end, total } }
    currentStart: 0,

    startQuestion(qIndex) {
        if (!this.questionTimes[qIndex]) {
            this.questionTimes[qIndex] = { total: 0, visits: 0 };
        }
        this.currentStart = Date.now();
        this.questionTimes[qIndex].visits++;
    },

    endQuestion(qIndex) {
        if (this.currentStart && this.questionTimes[qIndex]) {
            this.questionTimes[qIndex].total += Date.now() - this.currentStart;
        }
        this.currentStart = 0;
    },

    getTimeSpent(qIndex) {
        const data = this.questionTimes[qIndex];
        if (!data) return 0;
        let time = data.total;
        if (this.currentStart && App.currentQ === qIndex) {
            time += Date.now() - this.currentStart;
        }
        return time;
    },

    getTotalTime() {
        let total = 0;
        for (const qIndex in this.questionTimes) {
            total += this.getTimeSpent(parseInt(qIndex));
        }
        return total;
    },

    getAvgTimePerQuestion() {
        const visited = Object.keys(this.questionTimes).length;
        return visited > 0 ? this.getTotalTime() / visited : 0;
    },

    reset() {
        this.questionTimes = {};
        this.currentStart = 0;
    },

    // Get stats by category
    getCategoryStats(questions, answers) {
        const catStats = {};
        questions.forEach((q, i) => {
            const cat = q.category || 'General';
            if (!catStats[cat]) {
                catStats[cat] = { correct: 0, total: 0, time: 0, answered: 0 };
            }
            catStats[cat].total++;
            if (answers[i] !== undefined) {
                catStats[cat].answered++;
                if (answers[i] === q.correctAnswer) catStats[cat].correct++;
            }
            catStats[cat].time += this.getTimeSpent(i);
        });
        return catStats;
    },

    // Build metrics summary HTML for score screen
    buildMetricsSummary(questions, answers) {
        const totalTime = this.getTotalTime();
        const avgTime = this.getAvgTimePerQuestion();
        const catStats = this.getCategoryStats(questions, answers);

        // Find slowest and fastest questions
        const times = [];
        for (let i = 0; i < questions.length; i++) {
            times.push({ index: i, time: this.getTimeSpent(i) });
        }
        times.sort((a, b) => b.time - a.time);
        const slowest = times.slice(0, 3).filter(t => t.time > 0);

        let html = '<div class="metrics-summary"><h3>Performance Metrics</h3>';
        html += '<div class="metrics-grid">';
        html += `<div class="metric-item"><div class="metric-val">${this._formatTime(totalTime)}</div><div class="metric-lbl">Total Time</div></div>`;
        html += `<div class="metric-item"><div class="metric-val">${this._formatTime(avgTime)}</div><div class="metric-lbl">Avg per Question</div></div>`;
        html += `<div class="metric-item"><div class="metric-val">${Object.keys(this.questionTimes).length}</div><div class="metric-lbl">Questions Viewed</div></div>`;
        html += '</div>';

        if (slowest.length > 0) {
            html += '<div class="time-per-q"><strong>Most Time Spent:</strong><table><tr><th>Q#</th><th>Time</th><th>Category</th></tr>';
            slowest.forEach(s => {
                const q = questions[s.index];
                html += `<tr><td>${s.index + 1}</td><td>${this._formatTime(s.time)}</td><td>${q.category || 'General'}</td></tr>`;
            });
            html += '</table></div>';
        }

        // Category time breakdown
        html += '<div class="time-per-q" style="margin-top:16px"><strong>Time by Category:</strong><table><tr><th>Category</th><th>Time</th><th>Avg/Q</th></tr>';
        Object.entries(catStats).sort((a, b) => b[1].time - a[1].time).forEach(([cat, data]) => {
            const avgCatTime = data.total > 0 ? data.time / data.total : 0;
            html += `<tr><td>${cat}</td><td>${this._formatTime(data.time)}</td><td>${this._formatTime(avgCatTime)}</td></tr>`;
        });
        html += '</table></div>';

        html += '</div>';
        return html;
    },

    _formatTime(ms) {
        const secs = Math.round(ms / 1000);
        if (secs < 60) return secs + 's';
        const mins = Math.floor(secs / 60);
        const remainSecs = secs % 60;
        return mins + 'm ' + remainSecs + 's';
    }
};

// =====================================================================
// KEYBOARD SHORTCUTS
// =====================================================================
document.addEventListener('keydown', (e) => {
    // Calculator shortcut works globally
    if (e.key === 'c' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
        Calc.toggle();
        return;
    }
    // Escape closes calculator
    if (e.key === 'Escape' && Calc.isOpen) {
        Calc.toggle();
        return;
    }

    // Only in exam screen
    if (!document.getElementById('screen-exam').classList.contains('active')) return;
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

    if (e.key === 'ArrowRight' || e.key === 'n') App.next();
    if (e.key === 'ArrowLeft' || e.key === 'p') App.prev();
    if (e.key === 'b') App.toggleBookmark();
    if (e.key >= '1' && e.key <= '4' && !App.submitted && !App.practiceChecked[App.currentQ]) {
        App.selectOption(parseInt(e.key) - 1);
    }
    if (e.key === 'Enter' && App.mode === 'practice' && !App.practiceChecked[App.currentQ]) {
        App.checkAnswer();
    }
});

// =====================================================================
// INIT
// =====================================================================
async function init() {
    Settings.load();

    // Try loading the embedded fallback
    try {
        const script = document.getElementById('bankFallback');
        if (script) BANK_DATA = JSON.parse(script.textContent);
    } catch {}

    await BankManager.loadAll();

    // If no banks loaded via fetch and no embedded data, try to load from BANK_DATA global
    if (BankManager.banks.length === 0) {
        // Last resort: show error
        document.getElementById('bankList').innerHTML = '<p style="text-align:center;color:var(--red);padding:40px">Could not load question banks. If using file:// protocol, the embedded bank data is needed.</p>';
    }

    Home.render();
}

document.addEventListener('DOMContentLoaded', init);
</script>

<!-- EMBEDDED BANK DATA FALLBACK (for file:// protocol) -->
<script id="bankFallback" type="application/json">
{"bankId":"algebra-fxo1","title":"Applied Algebra - FXO1","description":"WGU Applied Algebra pre-assessment practice (70 questions)","timeLimit":5400,"passingScore":70,"categories":["Function Notation","Graph Reading","Rate of Change","Linear Functions","Exponential & Logistic","Regression & Predictions","Concavity & Curvature"],"questions":[{"id":1,"text":"A local business is looking to become a franchise. The company wants to predict the number of franchises, F, given a certain number of years, Y. This prediction is modeled by the function F(Y).\n What can be concluded by F(5) = 10?","options":["Every 5 years, 10 stores will be opened.","Every 10 years, 5 stores will be opened.","In 5 years, there will be 10 open stores.","In 10 years, there will be 5 open stores."],"correctAnswer":2,"explanation":"F(5) = 10 means when Y = 5 (the input, years), F = 10 (the output, franchises). This reads as: in 5 years, there will be 10 open stores. The other options either swap the input/output or misinterpret function notation as a rate.","category":"Function Notation","tags":["function-notation","interpret-output","franchise"],"difficulty":1},{"id":2,"text":"A bank begins a marketing campaign to increase its number of customers. Each month, all new customers are put into a drawing. One customer then receives a $50 credit in a checking account.\n The amount of money given away in the drawing, G, is a function of the number of months, M, the drawing has been going on for.\n What is the correct function notation to represent the amount of money given away after the drawing has been going on for 5 months?","options":["G(250) = 5","G(5) = 10","G(5) = 250","G(10) = 5"],"correctAnswer":2,"explanation":"G is a function of M (months). After 5 months, $50 is given away each month, so the total is $50 x 5 = $250. The correct notation places the input (5 months) inside the parentheses and the output ($250) on the right: G(5) = 250.","category":"Function Notation","tags":["function-notation","evaluate","money"],"difficulty":1},{"id":3,"text":"The volume of calls, V(h), at a particular customer service center can be written as a function of the number of hours after opening each day, h.\n What would the ordered pair (6,8) represent for this function?","options":["There were 8 calls 6 hours after opening.","There were 6 calls 8 hours after opening.","There were h calls 6 hours after opening.","There were 8 calls V hours after opening."],"correctAnswer":0,"explanation":"In the ordered pair (6, 8), the first value is the input h = 6 (hours after opening) and the second value is the output V = 8 (number of calls). So there were 8 calls 6 hours after opening.","category":"Function Notation","tags":["function-notation","ordered-pair","interpret"],"difficulty":1},{"id":4,"text":"A company has developed two functions, L(t) and M(t), that determine the least amount and most amount, respectively, of revenue it will make in any given month in dollars (with t = 1 corresponding to January).\n What can the company reasonably conclude if L(2) = 3,000 and M(2) = 5,000?","options":["In February, it will make $2,000.","It cannot make more than $3,000 in February but can make up to $5,000 after February.","In February, it will make between $3,000 and $5,000.","It will make more money in February if it uses M(t) instead of L(t)."],"correctAnswer":2,"explanation":"L(2) = 3,000 gives the least revenue in February and M(2) = 5,000 gives the most. Therefore, actual revenue in February will fall between these bounds: between $3,000 and $5,000.","category":"Function Notation","tags":["function-notation","bounds","revenue"],"difficulty":1},{"id":5,"text":"A server at a restaurant has realized that tips, T, in dollars are related to the number of hours, h, that have been worked on any given day. Tips can be modeled by the function T(h) = X.\n How can this function be interpreted?","options":["If the server works T hours, the tips will be $h.","If the server works h hours, the tips will be $X.","If the server works h hours, the tips will be $T(X).","If the server works X hours, the tips will be $T."],"correctAnswer":1,"explanation":"T(h) = X means the input is h (hours worked) and the output is X (dollar amount of tips). So if the server works h hours, the tips will be $X. The function T takes hours as input and returns tip dollars as output.","category":"Function Notation","tags":["function-notation","interpret","real-world"],"difficulty":1},{"id":6,"text":"A company pays its employees a base salary each month plus a commission, C, based on the number of sales, s, made by an employee during the month. An employee made 8 sales in the last month and received a commission of $1,600.\n How would this be represented in function notation?","options":["C(8) = 1600","C(1600) = 8","s(1600) = 8","s(8) = 1600"],"correctAnswer":0,"explanation":"Commission C is a function of sales s. With 8 sales (input) producing $1,600 commission (output), the correct notation is C(8) = 1600. The function name is C, the input is the number of sales, and the output is the commission amount.","category":"Function Notation","tags":["function-notation","write-notation","commission"],"difficulty":1},{"id":7,"text":"Below is a growth graph of a business. It compares gross growth and net growth.\n [Graph: Gross vs Net Growth 2010-2016]\n What can be said about the growth between the years of 2012 and 2014?","options":["Both gross and net growth decreased.","Both gross and net growth increased.","The gross growth decreased while the net growth increased.","The gross growth increased while the net growth decreased."],"correctAnswer":3,"explanation":"Between 2012 and 2014, the gross growth line trends upward while the net growth line trends downward. This means the company's total revenue grew, but after expenses, the net growth actually declined.","category":"Graph Reading","tags":["graph-reading","compare-trends","growth"],"difficulty":2},{"id":8,"text":"The graph below shows the three-month average percentage year-on-year growth for real total pay for the years 2010-2016, along with the Office for Budget Responsibility's (OBR's) growth forecast for the years 2016-2021.\n [Graph: Real Total Pay Growth]\n What can be concluded from this graph?","options":["The real total pay growth outturn exceeded 3% at some point between 2010 and 2016.","The real total pay growth outturn remained between -2% and 2% from 2010 and 2016.","The OBR forecasts the growth will remain above 1% between 2016 and 2021.","The OBR forecasts the growth will remain between 1% and 2% between 2016 and 2021."],"correctAnswer":1,"explanation":"Reading the graph carefully, the real total pay growth outturn line stays within the range of -2% to 2% throughout the 2010-2016 period. It never exceeds 3%, and the OBR forecast does not consistently stay above 1%.","category":"Graph Reading","tags":["graph-reading","range","pay-growth"],"difficulty":2},{"id":9,"text":"The following graph shows the profits of a company for the last fiscal year.\n [Graph: Company Profits]\n Approximately how much have the company's profits increased over the last year?","options":["50%","30%","110%","80%"],"correctAnswer":3,"explanation":"Reading the graph, the profits approximately doubled from around $1 million to $1.8 million over the year. The percentage increase is roughly (1.8 - 1.0)/1.0 = 80%. This is closest to 80% among the choices.","category":"Graph Reading","tags":["graph-reading","percent-change","profit"],"difficulty":2},{"id":10,"text":"Black Monday occurred on October 19, 1987, and represents the single largest decline of the Dow Jones average in history.\n The function f represents a seven-month period during which Black Monday occurred. The function value f(1) represents the Dow Jones average in June of 1987.\n [Graph: Dow Jones 1987]\n Which function value represents the Dow Jones average during the month when Black Monday occurred?","options":["f(6)","f(4)","f(5)","f(10)"],"correctAnswer":2,"explanation":"If f(1) = June 1987, then f(2) = July, f(3) = August, f(4) = September, and f(5) = October. Since Black Monday occurred in October 1987, the answer is f(5).","category":"Function Notation","tags":["function-notation","counting","historical"],"difficulty":2},{"id":11,"text":"The unemployment rate in Poland for the time period from 1990 to 2012 is shown in the graph below using the function U(t) (measured as a percentage), where t is the year.\n [Graph: Poland Unemployment Rate]\n What can be concluded based on this graph?","options":["The two lowest unemployment rates were U(1998) and U(2008).","The largest two-year increase in unemployment was from 1990 to 1992.","U(1992) was the same as U(2002).","The largest two-year decrease in unemployment was from 1996 to 1998."],"correctAnswer":0,"explanation":"Reading the graph, the unemployment rate hits its lowest points (troughs) around 1998 and 2008. These two years represent the local minimums on the graph, making them the two lowest unemployment rates in the period shown.","category":"Graph Reading","tags":["graph-reading","minimum","unemployment"],"difficulty":2},{"id":12,"text":"The graph of the function C below represents the number of coal miners in the United States from 1985 to 2015.\n C(y) represents the number of coal miners in the United States in the year y.\n [Graph: US Coal Miners]\n Which interpretation of the function C is accurate?","options":["C(2015) represents 68 coal miners in 2015.","C(1990) represents 140,000 coal miners in 1990.","C(1995) represents 100 coal miners in 1995.","C(2000) represents 70,000 coal miners in 2000."],"correctAnswer":1,"explanation":"Reading the graph at year 1990, the value is approximately 140,000 coal miners. The graph measures in thousands, so C(1990) = 140,000 is correct. The other options either misread the scale or confuse units.","category":"Graph Reading","tags":["graph-reading","scale","interpret-value"],"difficulty":2},{"id":13,"text":"The following table compares the number of employees hired and the number of employees dismissed over an 11-year period for a certain business.\n Year: 2007-2017, Hired vs Dismissed data provided.\n What can be concluded from this table?","options":["Fewer employees were hired than dismissed each year.","More employees were hired in 2007 and 2008 than in 2010 and 2011.","More employees were dismissed in 2016 and 2017 than in 2014 and 2015.","More employees were hired than dismissed each year."],"correctAnswer":3,"explanation":"Checking each year: 2007 (50>10), 2008 (20>10), 2009 (30>5), 2010 (21>17), 2011 (60>30), 2012 (70>15), 2013 (40>20), 2014 (15>5), 2015 (20>6), 2016 (10>2), 2017 (10>7). In every year, more employees were hired than dismissed.","category":"Graph Reading","tags":["table-reading","compare","employees"],"difficulty":1},{"id":14,"text":"A company has the following information on last quarter's sales (month 7 refers to July):\n Month 7: $303K, Month 8: $328K, Month 9: $333K\n What was the average rate of change over the entire quarter (from July to September)?","options":["Sales increased an average of $6,285.71 per month.","Sales increased an average of $10,000 per month.","Sales increased an average of $37,000 per month.","Sales increased an average of $15,000 per month."],"correctAnswer":3,"explanation":"Average rate of change = (333 - 303)/(9 - 7) = 30/2 = 15 thousand dollars per month. Since sales are in thousands, this is $15,000 per month. The rate is calculated over the entire interval from July (month 7) to September (month 9).","category":"Rate of Change","tags":["rate-of-change","average","sales"],"difficulty":1},{"id":15,"text":"An IT firm generates the following numbers to estimate its revenue in thousands of dollars based on the number of employees working on a project.\n Employees: 10,20,30,40,50 | Revenue: $12.40K, $21.99K, $30.74K, $36.01K, $38.43K\n Which conclusion can be made by examining the average rate of change between consecutive rows?","options":["The revenue is increasing steadily in relation to the number of employees.","The revenue is increasing at slower and slower rates in relation to the number of employees.","The revenue is not increasing in relation to the number of employees.","The revenue is increasing at faster and faster rates in relation to the number of employees."],"correctAnswer":1,"explanation":"Computing the rate of change between consecutive rows: (21.99-12.40)/10 = 0.959, (30.74-21.99)/10 = 0.875, (36.01-30.74)/10 = 0.527, (38.43-36.01)/10 = 0.242. Each successive rate is smaller, meaning revenue increases at slower and slower rates.","category":"Rate of Change","tags":["rate-of-change","decreasing-rate","revenue"],"difficulty":2},{"id":16,"text":"An airplane was cruising at an altitude of 39,000 feet and descended as shown in the table below.\n Time (min): 0,10,20,30,40,50,60 | Altitude (ft): 39000,33000,27000,21000,15000,9000,3000\n What can be concluded from this table?","options":["The airplane had a descent rate of 600 ft./min.","At minute 70, the airplane landed.","At minute 60, the airplane landed.","The airplane had a descent rate of 6,000 ft./min."],"correctAnswer":0,"explanation":"The altitude drops by 6,000 feet every 10 minutes: (39000 - 33000)/10 = 600 ft/min. This is a constant descent rate. At minute 60 the plane is still at 3,000 feet (not landed), and 6,000 ft/min would be far too fast.","category":"Rate of Change","tags":["rate-of-change","constant","descent"],"difficulty":1},{"id":17,"text":"The function table below shows a company's revenue function (R) and expense function (E) for each month.\n Monthly Revenues and Expenses for months 1-12 provided.\n Which conclusion can be made about this function table?","options":["Since R(11) is $10,234 and E(11) is $3,786, there was not a profit in November.","The lowest profit occurred during May.","Since R(2) is $3,220 and E(2) is $3,957, there was a profit in February.","The highest profit occurred during October."],"correctAnswer":3,"explanation":"Profit = Revenue - Expenses. For October: R(10) - E(10) = $12,337 - $927 = $11,410. Checking other months confirms this is the highest profit. February actually had a loss ($3,220 - $3,957 = -$737), and November had a profit ($10,234 - $3,786 = $6,448).","category":"Rate of Change","tags":["table-reading","profit","compute"],"difficulty":2},{"id":18,"text":"The original value of a company car bought in January of 2006 was $22,800. Below is a function table that tracks the value of the car V(y) as it depreciates from 2006 to 2015.\n Which other conclusion can be reached from this table?","options":["V(y) decreases the most from 2006 to 2007.","V(y) decreases by the same amount each year.","V(2013) = $22,800 - $6,879","V($4,970) = 2015"],"correctAnswer":0,"explanation":"From 2006 to 2007: $22,800 - $18,240 = $4,560 decrease. From 2007 to 2008: $18,240 - $15,504 = $2,736. Each subsequent year's decrease is smaller than $4,560, so the largest single-year decrease is from 2006 to 2007.","category":"Rate of Change","tags":["rate-of-change","depreciation","maximum-change"],"difficulty":2},{"id":19,"text":"The salvage or depreciated value, V, of a new truck purchased for $58,000 is given by the linear function V(t) = 58,000 - 4,000t, where t is the time in years between 0 and 10.\n What is the correct interpretation of V(3)?","options":["The truck's depreciated value after 5 years is $54,000.","The truck's depreciated value after 3 years is $46,000.","The truck's depreciated value after 5 years is $42,000.","The truck's depreciated value after 3 years is $50,000."],"correctAnswer":1,"explanation":"V(3) = 58,000 - 4,000(3) = 58,000 - 12,000 = $46,000. Plugging t = 3 into the function gives the truck's value after 3 years. The truck depreciates by $4,000 each year.","category":"Linear Functions","tags":["linear","evaluate","depreciation"],"difficulty":1},{"id":20,"text":"In the function C(x) = 21.25 + 0.25x, C(x) represents the total cost, in dollars, for a passenger to ride a shuttle service for x miles.\n What is the total cost for a passenger to ride the shuttle for 50 miles?","options":["$33.75","$12.50","$26.25","$50.25"],"correctAnswer":0,"explanation":"C(50) = 21.25 + 0.25(50) = 21.25 + 12.50 = $33.75. The base fare is $21.25, plus $0.25 per mile for 50 miles adds $12.50 to the total.","category":"Linear Functions","tags":["linear","evaluate","cost"],"difficulty":1},{"id":21,"text":"A company's total monthly cost is given by the linear function C(x) = 11,000 + 550x, where C is the total monthly cost and x is the number of units produced each month.\n What does the y-intercept represent in this situation?","options":["If 0 items are produced, the monthly cost is $550.00.","If 0 items are produced, the monthly cost is $11,000.00.","If 550 items are produced, the monthly cost is $0.00.","If 11,000 items are produced, the monthly cost is $0.00."],"correctAnswer":1,"explanation":"The y-intercept occurs when x = 0. C(0) = 11,000 + 550(0) = $11,000. This represents the fixed monthly cost when no items are produced. The $550 is the slope (cost per additional unit), not the y-intercept.","category":"Linear Functions","tags":["linear","y-intercept","fixed-cost"],"difficulty":1},{"id":22,"text":"A cable company, a satellite dish company, and a streaming service all offer TV viewing plans based on the number of channels, c.\n Cable: P(c) = 3c + 60\n Satellite dish: P(c) = 4c + 35\n Streaming service: P(c) = 5c + 50\n Which company's cost per additional channel is most expensive?","options":["Satellite dish company","Cable company","Streaming service","All have the same cost per channel"],"correctAnswer":2,"explanation":"The cost per additional channel is the slope of each linear function. Cable = $3/channel, Satellite = $4/channel, Streaming = $5/channel. The streaming service has the highest slope at $5 per channel, making it the most expensive per additional channel.","category":"Linear Functions","tags":["linear","slope","compare"],"difficulty":1},{"id":23,"text":"The number of gym memberships since January 1, 2015, for a particular gym is given by the function N(x) = 100 + 11x, where N is the number of gym members x months after January 1, 2015.\n How can the slope be interpreted?","options":["Each month, 100 members join the gym.","Each month, 11 members cancel their membership.","Each month, 100 members cancel their membership.","Each month, 11 members join the gym."],"correctAnswer":3,"explanation":"In N(x) = 100 + 11x, the slope is 11, meaning the number of members increases by 11 each month. The 100 is the y-intercept (starting members). A positive slope of 11 means 11 new members join per month.","category":"Linear Functions","tags":["linear","slope-interpretation","membership"],"difficulty":1},{"id":24,"text":"The pricing models of four contractors are given below, where t is the number of hours worked and P is the total cost of the job.\n Contractor A: P(t) = 100 + 20t\n Contractor B: P(t) = 99 + 25t\n Contractor C: P(t) = 50 + 35t\n Contractor D: P(t) = 80 + 25t\n Which contractor gives the cheapest hourly rate?","options":["Contractor B","Contractor D","Contractor C","Contractor A"],"correctAnswer":3,"explanation":"The hourly rate is the slope (coefficient of t) in each function. A = $20/hr, B = $25/hr, C = $35/hr, D = $25/hr. Contractor A has the lowest hourly rate at $20 per hour, even though their flat fee ($100) is the highest.","category":"Linear Functions","tags":["linear","slope","compare-rates"],"difficulty":1},{"id":25,"text":"An appliance manufacturer has determined that the profit, P(x), that it makes in manufacturing and selling x dishwashers can be determined from the function in the graph below.\n [Graph: Profit vs Dishwashers]\n How many dishwashers must the company manufacture and sell in order to make a profit of $80,000?","options":["30","130","140","120"],"correctAnswer":1,"explanation":"Reading the graph at P(x) = $80,000 on the y-axis and tracing horizontally to the curve, then down to the x-axis, the value lands at approximately 130 dishwashers. This is where the profit function reaches $80,000.","category":"Graph Reading","tags":["graph-reading","find-input","profit"],"difficulty":2},{"id":26,"text":"The profit function P(x) gives a company's total profit (in millions of U.S. dollars) for x products produced (in thousands). The graph of P(x) is below.\n [Graph: Profit Function]\n At which number of products produced does the company stop being profitable?","options":["About 1,000 items","About 3,000 items","About 2,500 items","About 4,500 items"],"correctAnswer":3,"explanation":"The company stops being profitable when P(x) = 0 (the graph crosses the x-axis from positive to negative). Reading the graph, this zero-crossing occurs at approximately x = 4.5 (in thousands), which is about 4,500 items.","category":"Graph Reading","tags":["graph-reading","zero","break-even"],"difficulty":2},{"id":27,"text":"A big box store found its number of customers, C, in thousands on Saturday is predicted by the time of day in hours, t. t = 0 corresponds to midnight.\n [Graph: Customers vs Time]\n How should the average rate of change from t = 8 to t = 10 be interpreted?","options":["There are, on average, 1,000 more customers per hour.","There are, on average, 2,000 fewer customers per hour.","There are, on average, 2,000 more customers per hour.","There are, on average, 1,000 fewer customers per hour."],"correctAnswer":0,"explanation":"Reading the graph: C(8) = 1 thousand and C(10) = 3 thousand. Average rate of change = (3 - 1)/(10 - 8) = 2/2 = 1 thousand customers per hour. Since the values are in thousands, this means 1,000 more customers per hour on average.","category":"Rate of Change","tags":["rate-of-change","average","customers"],"difficulty":2},{"id":28,"text":"The profit for a manufacturer of a certain product is given by the function P(x) = -4x^3 + 12x^2 + 16x, where P is the total profit (in thousands of dollars) for x items produced (in thousands).\n What is the average rate of change from x = 4 to x = 8?","options":["Profit increases by $288,000 per 1,000 items produced.","Profit decreases by $1,152,000 per 1,000 items produced.","Profit decreases by $288,000 per 1,000 items produced.","The profit neither increases nor decreases per 1,000 items produced."],"correctAnswer":2,"explanation":"P(4) = -4(64) + 12(16) + 16(4) = -256 + 192 + 64 = 0. P(8) = -4(512) + 12(64) + 16(8) = -2048 + 768 + 128 = -1152. Average rate = (-1152 - 0)/(8 - 4) = -1152/4 = -288 thousand dollars per thousand items. Profit decreases by $288,000 per 1,000 items.","category":"Rate of Change","tags":["rate-of-change","polynomial","compute"],"difficulty":3},{"id":29,"text":"The graph below represents the projected year-end assets, A(t), in the Social Security trust fund in trillions of dollars, where t represents the number of years since 2000.\n [Graph: Social Security Trust Fund]\n At which value of t is the fund increasing the most rapidly?","options":["About t = 45","About t = 7","About t = 30","About t = 0"],"correctAnswer":1,"explanation":"The fund is increasing most rapidly where the graph has its steepest positive slope. Looking at the graph, the steepest upward section occurs around t = 7 (approximately year 2007), where the curve is rising most sharply before it begins to flatten and eventually decline.","category":"Graph Reading","tags":["graph-reading","steepest-slope","social-security"],"difficulty":2},{"id":30,"text":"A local coffee shop found that its number of customers, N, can be predicted by the time of day in hours, t. The opening time of 5:00 a.m. corresponds to t = 0.\n [Graph: Coffee Shop Customers]\n How should the graph be interpreted between t = 5.5 and t = 9?","options":["Between 10:30 a.m. and 2:00 p.m., the number of customers is increasing slower and slower and then increasing faster and faster.","Between 10:30 a.m. and 2:00 p.m., the number of customers is increasing faster and faster and then decreasing slower and slower.","Between 10:30 a.m. and 2:00 p.m., the number of customers is increasing faster and faster and then increasing slower and slower.","Between 10:30 a.m. and 2:00 p.m., the number of customers is decreasing faster and faster and then increasing slower and slower."],"correctAnswer":2,"explanation":"Since t = 0 is 5:00 a.m., t = 5.5 is 10:30 a.m. and t = 9 is 2:00 p.m. The graph shows an S-shaped increase in this region: first concave up (increasing faster and faster), then an inflection point, then concave down (increasing slower and slower).","category":"Concavity & Curvature","tags":["concavity","inflection","interpret-graph"],"difficulty":3},{"id":31,"text":"The total profit, P(x), in thousands of dollars from the production of x thousands of laptop computers is given by the graph below. For this graph, x must be greater than or equal to 5.\n [Graph: Laptop Profit]\n How many laptops must be produced to maximize the profit?","options":["700,000","10","10,000","700"],"correctAnswer":2,"explanation":"Reading the graph, the maximum profit occurs at approximately x = 10. Since x is measured in thousands of laptops, x = 10 means 10,000 laptops. The peak of the profit curve is at this production level.","category":"Graph Reading","tags":["graph-reading","maximum","units"],"difficulty":2},{"id":32,"text":"For the years since a department store has been open, its annual revenue, R, (in millions of dollars) can be modeled by the function graphed below, where t is the number of years since the store opened.\n [Graph: Department Store Revenue]\n How should the maximum revenue be interpreted?","options":["About 4 years after the department store opened, the store earned a maximum revenue of about $1,600,000.00.","About 6 years after the department store opened, the store earned a maximum revenue of about $1,400,000.00.","About 14 years after the department store opened, the store earned a maximum revenue of about $1,400,000.00.","About 6 years after the department store opened, the store earned a maximum revenue of about $1,600,000.00."],"correctAnswer":3,"explanation":"Reading the graph, the peak (maximum) of the revenue curve occurs at approximately t = 6 years, with R approximately equal to 1.6 million dollars ($1,600,000). The revenue rises to this peak and then declines afterward.","category":"Graph Reading","tags":["graph-reading","maximum","revenue"],"difficulty":2},{"id":33,"text":"The population of the United States in millions of people can be estimated with the function P(t) = 282(1.01)^t, where t = 0 represents the population, P, in the year 2000, and t is measured in years.\n What does P(-2) represent?","options":["P(-2) represents the opposite of the population in 2002, which was approximately 250 million people.","P(-2) represents the population in 2002, which was approximately 288 million people.","P(-2) represents the population in 1998, which was approximately 276 million people.","P(-2) represents twice the population of 2000, which was approximately 564 million people."],"correctAnswer":2,"explanation":"Since t = 0 is the year 2000, t = -2 is two years before 2000, which is 1998. P(-2) = 282(1.01)^(-2) = 282/1.0201 = approximately 276 million people. Negative t values go backward in time from the reference year.","category":"Exponential & Logistic","tags":["exponential","negative-input","population"],"difficulty":2},{"id":34,"text":"A high-interest loan company uses the function L(d) = 100e^(0.02d) to calculate late fees, L, for payments overdue by d days.\n What does L(67) represent?","options":["L(67) is the average number of days a person waits to make a payment, which would be 67.","L(67) is the number of days that a payment is overdue, which would be 382 days.","L(67) is the overall amount due when a payment is 67 days overdue, which would be $67.","L(67) is the amount due in late fees for a payment that is 67 days overdue, which would be $381.90."],"correctAnswer":3,"explanation":"L(d) calculates late fees for d days overdue. L(67) = 100e^(0.02 x 67) = 100e^(1.34) = 100 x 3.819 = approximately $381.90. This is the late fee amount when the payment is 67 days overdue.","category":"Exponential & Logistic","tags":["exponential","evaluate","late-fees"],"difficulty":2},{"id":35,"text":"A bank uses the function A(t) = 1000(1.023)^t to calculate an account balance, A, after t years.\nWhat is the average rate of change of the account balance from t = 2 to t = 12?","options":["The account will decrease by $26.72, on average, each year.","The account will increase by $267.21, on average, each year.","The account will increase by $26.72, on average, each year.","The account will decrease by $267.21, on average, each year."],"correctAnswer":2,"explanation":"A(2) = 1000(1.023)^2 = 1046.53. A(12) = 1000(1.023)^12 = 1313.74. Average rate of change = (1313.74 - 1046.53)/(12 - 2) = 267.21/10 = $26.72 per year. The account balance increases on average by $26.72 each year over this period.","category":"Rate of Change","tags":["rate-of-change","exponential","banking"],"difficulty":2},{"id":36,"text":"A scientist found a sample of carbon-14 and knows the graph below models the exponential decay of carbon-14, where t is time measured in years and y is the amount of carbon-14 left in the sample in grams.\n [Graph: Carbon-14 Decay]\n What would the average rate of change over the time interval of t = 100 to t = 700 represent, and would that rate be positive or negative?","options":["It represents the annual change in the number of grams of carbon-14 between 100 and 700 years. The rate is negative.","It represents the annual change in 600 years per the number of grams of carbon-14. The rate is positive.","It represents the annual change in the number of grams of carbon-14 between 100 and 700 years. The rate is positive.","It represents the annual change in 600 years per the number of grams of carbon-14. The rate is negative."],"correctAnswer":0,"explanation":"The average rate of change = (y(700) - y(100))/(700 - 100), which gives the annual change in grams of carbon-14 over this 600-year interval. Since carbon-14 decays over time (decreasing function), y(700) < y(100), making the rate negative.","category":"Rate of Change","tags":["rate-of-change","decay","sign"],"difficulty":2},{"id":37,"text":"A company uses the function C = 15e^(-n) + 10, which is shown in the graph below, to model the average cost per toy produced, C, where n is the number of toys produced.\n [Graph: Cost per Toy]\n How should this horizontal asymptote be interpreted?","options":["As the number of toys produced increases, the average cost per toy tends toward $10.","As the cost of producing toys increases, the number of toys produced tends toward 10.","As the cost of producing toys increases, the number of toys produced tends toward 15.","As the number of toys produced increases, the average cost per toy tends toward $15."],"correctAnswer":0,"explanation":"As n approaches infinity, e^(-n) approaches 0, so C = 15(0) + 10 = 10. The horizontal asymptote is C = 10, meaning as more toys are produced, the average cost per toy approaches $10 but never quite reaches it.","category":"Exponential & Logistic","tags":["asymptote","exponential","cost"],"difficulty":2},{"id":38,"text":"Two medical operations are being compared to determine which is better for patients. Below is a graph of the chance of infection after operation (in percentage) for the first option (solid curve) and the second option (dashed curve), shown over time since 1950.\n [Graph: Infection Rates]\n As time has gone on, which is the better operation?","options":["Operation 1 is better because the chance of infection has dropped to a steady 15% since around the year 2000.","Operation 2 is better because the chance of infection has dropped to a steady 10% since around the year 2000.","Operation 2 is better because the chance of infection has dropped to a steady 15% since around the year 2000.","Operation 1 is better because the chance of infection has dropped to a steady 10% since around the year 2000."],"correctAnswer":1,"explanation":"Reading the graph, Operation 2 (dashed curve) has its infection rate leveling off at approximately 10% by around the year 2000, which is lower than Operation 1's steady rate of approximately 15%. Lower infection rate means a better operation.","category":"Graph Reading","tags":["graph-reading","asymptote","compare"],"difficulty":2},{"id":39,"text":"A factory with an assembly line can produce more automobiles per week as more employees are working at a given time, limited by the capacity of the assembly line. The model follows the function A(w) = 100/(1 + 25e^(-0.06w)) - 4, where A is the number of automobiles per week, and w is the number of workers.\n How many workers are needed to produce 50 automobiles per week?","options":["41 workers","57 workers","80 workers","96 workers"],"correctAnswer":1,"explanation":"Set A(w) = 50: 50 = 100/(1 + 25e^(-0.06w)) - 4, so 54 = 100/(1 + 25e^(-0.06w)). Then 1 + 25e^(-0.06w) = 100/54 = 1.852, so 25e^(-0.06w) = 0.852, e^(-0.06w) = 0.0341, -0.06w = ln(0.0341) = -3.378, w = 56.3, approximately 57 workers.","category":"Exponential & Logistic","tags":["logistic","solve","factory"],"difficulty":3},{"id":40,"text":"A cat population in a small town can be modeled with a logistic function and estimated with the table below, where t = 0 represents the cat population, P, in the year 2000, and t is measured in years.\n t: 1,2,3,4 | P(t): 24,55,103,150\n When does the cat population reach 110?","options":["During 2004","During 2001","During 2002","During 2003"],"correctAnswer":3,"explanation":"At t = 3, P(3) = 103 and at t = 4, P(4) = 150. Since 110 falls between 103 and 150, the population reaches 110 sometime between t = 3 and t = 4. Since t = 3 corresponds to year 2003, the population reaches 110 during 2003.","category":"Exponential & Logistic","tags":["logistic","table","interpolate"],"difficulty":2},{"id":41,"text":"A factory with an assembly line can produce more automobiles per week as more employees are working at a given time, limited by the capacity of the assembly line. The model follows the function A(w) = 100/(1 + 25e^(-0.06w)) - 4.\n The instantaneous rate of change at w = 50 is 1.\n How should this be interpreted?","options":["When the factory has 50 workers, the factory will produce 10 fewer cars for each worker added.","When the factory has 50 workers, the factory will produce 10 more cars for each worker added.","When the factory has 50 workers, the factory will produce 1 more car for each worker added.","When the factory has 50 workers, the factory will produce 1 fewer car for each worker added."],"correctAnswer":2,"explanation":"The instantaneous rate of change at w = 50 is 1, meaning the derivative A'(50) = 1. This means at exactly 50 workers, each additional worker adds approximately 1 more automobile per week to production.","category":"Exponential & Logistic","tags":["logistic","instantaneous-rate","interpret"],"difficulty":2},{"id":42,"text":"A rabbit population can be estimated with the function P(t) = 117/(1 + 5e^(-0.2t)), where t = 0 represents the rabbit population, P, in the year 2010, and t is measured in years.\n What is the average rate of change of the rabbit population from 2020 to 2040?","options":["The rabbit population is decreasing by about 115.57 rabbits per year during this time.","The rabbit population is increasing by about 115.57 rabbits per year during this time.","The rabbit population is increasing by about 2.29 rabbits per year during this time.","The rabbit population is decreasing by about 2.29 rabbits per year during this time."],"correctAnswer":2,"explanation":"2020 is t = 10 and 2040 is t = 30. P(10) = 117/(1 + 5e^(-2)) = 117/(1 + 0.677) = 69.79. P(30) = 117/(1 + 5e^(-6)) = 117/(1 + 0.0124) = 115.57. Average rate = (115.57 - 69.79)/20 = 45.78/20 = approximately 2.29 rabbits per year.","category":"Rate of Change","tags":["rate-of-change","logistic","population"],"difficulty":2},{"id":43,"text":"A factory with an assembly line produces automobiles and is limited by the capacity of its assembly line.\n [Graph: Automobile Production - Logistic Curve]\n What happens as additional workers between 10 workers and 40 workers are added?","options":["Adding additional workers increases the number of automobiles produced slower and slower.","Adding additional workers increases the number of automobiles produced faster and faster.","Adding additional workers decreases the number of automobiles produced faster and faster.","Adding additional workers decreases the number of automobiles produced slower and slower."],"correctAnswer":1,"explanation":"Between 10 and 40 workers on a logistic curve, we are in the early growth phase (before the inflection point). In this region, the curve is concave up, meaning production increases at an accelerating rate -- faster and faster with each additional worker.","category":"Concavity & Curvature","tags":["concavity","logistic","concave-up"],"difficulty":2},{"id":44,"text":"The function C(x), modeling cell phone price versus supply, is a decreasing logistic model (where C is the cost, and x is the number of cell phones available).\n [Graph: Cell Phone Cost - Decreasing Logistic]\n What is happening from x = 100 to x = 300?","options":["The cost of the phone is decreasing faster and faster.","The cost of the phone is increasing slower and slower.","The cost of the phone is increasing faster and faster.","The cost of the phone is decreasing slower and slower."],"correctAnswer":3,"explanation":"In a decreasing logistic model, the region from x = 100 to x = 300 is past the inflection point. The cost is still decreasing but the curve is flattening out (concave up for a decreasing function), meaning the cost decreases slower and slower as it approaches its lower asymptote.","category":"Concavity & Curvature","tags":["concavity","logistic","decreasing"],"difficulty":2},{"id":45,"text":"A factory with an assembly line can produce more automobiles per week as more employees are working at a given time, limited by the capacity of the assembly line. The model follows the function A(w) = 100/(1 + 25e^(-0.06w)) - 4.\n [Graph: Automobile Production]\n How should the upper horizontal asymptote be interpreted?","options":["The factory can produce a maximum of approximately 140 automobiles per week.","The factory can produce a maximum of approximately 95 automobiles per week.","The upper asymptote has no real world meaning in this scenario.","If there is a negative number of workers, then the number of automobiles produced is negative."],"correctAnswer":1,"explanation":"As w approaches infinity, e^(-0.06w) approaches 0, so A = 100/(1 + 0) - 4 = 100 - 4 = 96, which is approximately 95. The upper asymptote represents the maximum production capacity of the assembly line, regardless of how many workers are added.","category":"Exponential & Logistic","tags":["logistic","asymptote","capacity"],"difficulty":2},{"id":46,"text":"The rate that a rumor spreads through a middle school can be determined using the graph below, where R is the number of people who have heard the rumor after d days.\n [Graph: Rumor Spread]\n When should approximately 25% of the maximum number of people hear the rumor?","options":["On day 7","On day 1","On day 3","On day 5"],"correctAnswer":2,"explanation":"Reading the logistic growth graph, the maximum number of people who hear the rumor is the upper asymptote. 25% of that maximum corresponds to the early growth phase. Tracing the graph to where it reaches approximately one quarter of its maximum value leads to approximately day 3.","category":"Graph Reading","tags":["graph-reading","logistic","percentage"],"difficulty":2},{"id":47,"text":"The following graph shows the number of page views for a company's website over time (in months).\n [Graph: Page Views]\n During which month were there approximately 100 page views?","options":["July","February","June","March"],"correctAnswer":2,"explanation":"Reading the graph at y = 100 page views and tracing horizontally to the curve, then down to the x-axis, the month that corresponds to approximately 100 page views is June.","category":"Graph Reading","tags":["graph-reading","find-input","page-views"],"difficulty":1},{"id":48,"text":"The following graph measures revenue from vending machines at a large business on a typical day. The y-axis shows revenue in dollars, and the x-axis shows time based on the 24-hour clock. Revenue was measured every 15 minutes from 7:00 a.m. (700) to 8:00 p.m. (2000).\n [Graph: Vending Machine Revenue]\n What indicates that a shift ends at 5:00 p.m. (1700)?","options":["The vending machine revenues spike around 5:00 p.m. to about $55.","The vending machine revenues fall around 5:00 p.m. to about $20.","The vending machine revenues spike around 5:00 p.m. to about $100.","The vending machine revenues fall around 5:00 p.m. to about $40."],"correctAnswer":0,"explanation":"When a shift ends, employees take breaks and use vending machines before leaving, causing a spike in revenue. The graph shows a revenue spike around 5:00 p.m. reaching approximately $55, indicating the end of a work shift.","category":"Graph Reading","tags":["graph-reading","spike","interpret-event"],"difficulty":2},{"id":49,"text":"The following graph shows the price of the stock of a company x months after December 2014.\n [Graph: Stock Price]\n A program is set to automatically buy this stock on the first day of the month, provided the price is below $20. What month would it have first bought this stock, and would the investment have increased in value the following month?","options":["August 2016; yes, the stock would have increased in value the next month.","November 2015; no, the stock would not have increased in value the next month.","February 2015; no, the stock would not have increased in value the next month.","September 2015; yes, the stock would have increased in value the next month."],"correctAnswer":3,"explanation":"Reading the graph, the stock first drops below $20 at September 2015 (9 months after December 2014). Looking at the next month (October 2015), the stock price increased. So the program would have first bought in September 2015, and the investment would have gained value.","category":"Graph Reading","tags":["graph-reading","threshold","stock"],"difficulty":2},{"id":50,"text":"The following graph shows the number of page views for a company's website over time (in months).\n [Graph: Page Views Over Time]\n Estimate and interpret the average rate of change for the company's page views between March and August.","options":["The average rate of change was about -400 page views per month between these times, which means that the company's page views went down 400 on average each month between these times.","The average rate of change was about 240 page views per month between these times, which means that the company's page views went up 240 on average each month between these times.","The average rate of change was about -240 page views per month between these times, which means that the company's page views went down 240 on average each month between these times.","The average rate of change was about 400 page views per month between these times, which means that the company's page views went up 400 on average each month between these times."],"correctAnswer":2,"explanation":"Reading the graph: March page views are approximately 1,400 and August page views are approximately 200. Average rate of change = (200 - 1400)/(8 - 3) = -1200/5 = -240 page views per month. The negative sign indicates page views decreased on average.","category":"Rate of Change","tags":["rate-of-change","average","negative"],"difficulty":2},{"id":51,"text":"A chain of stores started out as 100 stores the first year, then increased by 400 stores the following year, and then increased each year for the next six years.\n [Graph: Store Growth]\n Which statement about the average rate of change is correct?","options":["The average rate of change from years 1 to 7 is 6 stores per year.","The average rate of change from years 1 to 4 is less than the average rate of change for years 4 to 7.","The average rate of change from years 1 to 7 is 1,200 stores per year.","The average rate of change from years 1 to 4 is greater than the average rate of change from years 4 to 7."],"correctAnswer":1,"explanation":"The graph shows accelerating growth (concave up). When growth is accelerating, the average rate of change over later intervals is greater than over earlier intervals. Therefore, the rate from years 4 to 7 is greater than from years 1 to 4, meaning the rate from years 1 to 4 is less than from years 4 to 7.","category":"Rate of Change","tags":["rate-of-change","compare-intervals","accelerating"],"difficulty":2},{"id":52,"text":"Each point on the following graph represents the revenue returned from a project with a specified marketing budget. The y-axis measures the revenue in thousands of dollars, and the x-axis represents the budget in thousands of dollars.\n [Graph: Revenue vs Budget]\n Which budget should new projects have at this company to maximize revenue?","options":["New projects should have a budget of $9,000 since this returned a revenue of $19,000.","New projects should have a budget of $19,000 since this returned a revenue of $9,000.","New projects should have a budget of $20,000 since this returned a revenue of $6,000.","New projects should have a budget of $6,000 since this returned a revenue of $20,000."],"correctAnswer":0,"explanation":"Reading the scatterplot, the data point with the highest revenue (y-value) is at approximately (9, 19), meaning a budget of $9,000 returned a revenue of $19,000. This is the maximum revenue observed in the data.","category":"Graph Reading","tags":["graph-reading","maximum","scatterplot"],"difficulty":2},{"id":53,"text":"The following graph represents profit on the y-axis (in thousands of dollars) based on production levels on the x-axis (in thousands of units). Each valley represents the decrease in profit after a major production expansion.\n [Graph: Profit with Expansions]\n After which production expansion do profits increase the fastest on average?","options":["The expansion at 9,500 units","The expansion at 3,500 units","The expansion at 1,500 units","The expansion at 6,500 units"],"correctAnswer":1,"explanation":"After each expansion (valley), profits recover and increase. The expansion at 3,500 units shows the steepest upward slope in the recovery phase, meaning profits increase the fastest on average after this particular expansion compared to the others.","category":"Graph Reading","tags":["graph-reading","rate-of-change","expansion"],"difficulty":3},{"id":54,"text":"In last week's sales meeting, a supervisor at a company stressed that current sales are increasing, but the graph of the sales is concave down. She seemed to emphasize this repeatedly to encourage the sales team to change the curvature of the sales.\n What could happen to the company sales if the sales graph keeps the trend of being concave down?","options":["Sales could begin decreasing faster and faster, or sales could begin increasing faster and faster.","Sales could begin decreasing slower and slower, or sales could begin decreasing faster and faster.","Sales could continue increasing slower and slower, or sales could begin decreasing slower and slower.","Sales could continue increasing slower and slower, or sales could begin decreasing faster and faster."],"correctAnswer":3,"explanation":"A concave down graph curves downward. If sales are currently increasing and the graph is concave down, sales are increasing slower and slower (the rate of increase is declining). If this trend continues, sales will eventually peak and begin decreasing. Once decreasing on a concave down graph, sales would decrease faster and faster.","category":"Concavity & Curvature","tags":["concavity","concave-down","prediction"],"difficulty":3},{"id":55,"text":"A technology firm in Erie, Pennsylvania, receives a contract to develop a computer program controlling the angle of a solar array on a daily basis. The firm first needs to model the hours of sunlight for every day of the year.\n From December to March, the hours of daylight are increasing faster and faster, and from March to June, they are increasing slower and slower.\n Which graph would be an appropriate model for this firm to use?","options":["Graph A","Graph B","Graph C","Graph D"],"correctAnswer":0,"explanation":"The description requires: increasing faster and faster (concave up) from December to March, then increasing slower and slower (concave down) from March to June, with an inflection point around March. Graph A shows this S-shaped pattern of concave up transitioning to concave down while continuously increasing.","category":"Concavity & Curvature","tags":["concavity","inflection","model-selection"],"difficulty":3},{"id":56,"text":"The following graph represents revenue from vending machines at a large business during a typical day. The y-axis represents revenue in dollars, and the x-axis represents time.\n [Graph: Vending Machine Revenue]\n What is the difference between the maximum revenue and the minimum revenue?","options":["$15","$100","$60","$85"],"correctAnswer":3,"explanation":"Reading the graph, the maximum revenue is approximately $100 and the minimum revenue is approximately $15. The difference is $100 - $15 = $85. This represents the range of daily revenue from the vending machines.","category":"Graph Reading","tags":["graph-reading","range","revenue"],"difficulty":1},{"id":57,"text":"The U.S. housing price index from 1970 to 2010 is plotted in the graph below.\n [Graph: US Housing Price Index]\n Which conclusion about this graph is correct?","options":["The lowest housing price index occurred in 1995, and the highest housing price index occurred in 2010.","The lowest housing price index occurred in 1970, and the highest housing price index occurred in 2010.","The lowest housing price index occurred in 2000, and the highest housing price index occurred in 2005.","The lowest housing price index occurred in 1970, and the highest housing price index occurred in 2005."],"correctAnswer":3,"explanation":"Reading the graph, the housing price index starts at its lowest point in 1970 and rises over the decades, reaching its peak around 2005 before declining. The highest value is around 2005, not 2010 (which shows the post-crash decline).","category":"Graph Reading","tags":["graph-reading","extremes","housing"],"difficulty":2},{"id":58,"text":"A company is trying to develop a computer algorithm to predict whether a customer will make a purchase of $100 or more. As the company collects more customer data, it updates its algorithm. The graph shows the algorithm's error rate for various amounts of customer data.\n [Graph: Error Rate]\n Which conclusion can the company make about the error rate for this algorithm?","options":["The error rate constantly decreases toward 0% error.","The error rate stabilizes and approaches an error rate of 2.5%.","The decrease in error rate is unsustainable and will eventually increase.","The asymptote indicates that 2.5% of customers make purchases of $100 or more in the online store."],"correctAnswer":1,"explanation":"The graph shows the error rate decreasing rapidly at first, then leveling off and approaching a horizontal asymptote at approximately 2.5%. The error rate stabilizes rather than continuing to decrease to 0%, indicating there is a fundamental limit to the algorithm's accuracy.","category":"Exponential & Logistic","tags":["asymptote","error-rate","algorithm"],"difficulty":2},{"id":59,"text":"The average cost in dollars, A(x), to produce x cell phone screen covers is given by the graph below.\n [Graph: Average Cost]\n What happens to the average cost as more and more covers are produced?","options":["The average cost increases to about $15 per cover.","The average cost reduces to about $0 per cover.","The average cost increases to about $4 per cover.","The average cost reduces to about $2 per cover."],"correctAnswer":3,"explanation":"Reading the graph, as x increases, the average cost curve decreases and approaches a horizontal asymptote at approximately $2 per cover. The cost decreases due to economies of scale but never reaches $0 because there are always some per-unit costs.","category":"Exponential & Logistic","tags":["asymptote","average-cost","economies-of-scale"],"difficulty":2},{"id":60,"text":"A software developer recently launched a new social media app and is studying user retention. Group A shared 3+ pictures in the first 5 days (solid line); Group B did not (dashed line). The graph shows retention rates over time.\n [Graph: User Retention]\n Which conclusion can be made from the data in this graph?","options":["The retention rates of both Group A and Group B stabilize as time increases and will eventually level off at the same rate.","The retention rate of Group B stabilizes as time increases, but the retention rate of Group A continues to decrease.","The retention rate of Group A stabilizes as time increases, but the retention rate of Group B continues to decrease.","The retention rates of both Group A and Group B stabilize as time increases and appear to have different asymptotes."],"correctAnswer":3,"explanation":"The graph shows both curves leveling off over time, each approaching its own horizontal asymptote. Group A (active users) stabilizes at a higher retention rate than Group B. The two different asymptotes indicate that early engagement (sharing pictures) leads to a permanently higher retention rate.","category":"Exponential & Logistic","tags":["asymptote","retention","compare-groups"],"difficulty":2},{"id":61,"text":"The following graph shows the sales of two popular items a company sells for a random sample of months. The company has chosen to fit the data with a linear model, and r^2 = 0.82.\n [Graph: Sales with Linear Fit]\n Is the linear function a good regression model for the data?","options":["No, the data would fit better with an exponential function.","Yes, the data is strongly correlated, and it has a roughly constant rate of change.","No, the data would fit better with a logistic function.","Yes, the data is S-shaped and therefore is best modeled by a linear function."],"correctAnswer":1,"explanation":"An r^2 value of 0.82 indicates a strong correlation (generally r^2 > 0.7 is considered strong). The data shows a roughly linear pattern with a constant rate of change, making a linear model appropriate. The data is not S-shaped or exponential in nature.","category":"Regression & Predictions","tags":["regression","r-squared","linear-fit"],"difficulty":2},{"id":62,"text":"A business wants to model the relationship between the number of items sold for two similar products. The monthly sales data for 20 months are shown in the graph below. The company fit its data with a linear model, which has an R-squared value of r^2 = 0.18.\n [Graph: Weak Linear Fit]\n What does r^2 imply for the fit of the model?","options":["This model has a weak fit; therefore, predictions should not be made based on this function.","This model has a weak fit; therefore, predictions can be reliably made based on this function.","This model has a moderate fit; therefore, predictions should not be made based on this function.","This model has a moderate fit; therefore, predictions can be reliably made based on this function."],"correctAnswer":0,"explanation":"An r^2 value of 0.18 means only 18% of the variation in the data is explained by the model. This is a very weak fit (well below 0.5). With such a weak correlation, predictions based on this model would be unreliable and should not be made.","category":"Regression & Predictions","tags":["regression","r-squared","weak-fit"],"difficulty":1},{"id":63,"text":"A real estate agent wanted to develop a model for the number of days a rental property sits vacant based on how the rental price compares to market value. The agent fit the data with an exponential function, which has an r^2 value of 0.83.\n [Graph: Vacancy vs Price]\n Is this exponential function a good regression model for the data?","options":["Yes, the data points increase by a constant rate.","No, there is a moderate correlation, and a linear function would be a better fit for the data.","Yes, there is a strong correlation, and the data points increase approximately by a constant ratio.","No, a polynomial model would be a better fit for the data."],"correctAnswer":2,"explanation":"With r^2 = 0.83, the correlation is strong. Exponential functions are characterized by data that increases by a constant ratio (multiplicative growth) rather than a constant amount. The data pattern matches exponential behavior, confirming the model is a good fit.","category":"Regression & Predictions","tags":["regression","exponential","constant-ratio"],"difficulty":2},{"id":64,"text":"A student created the scatterplot of data on the graph below. The x-axis represents the number of items, and the y-axis represents the total cost. The student drew a line of best fit. The calculator produced r^2 = 0.9946991797.\n [Graph: Items vs Cost]\n How can the value of r^2 be interpreted?","options":["The number of items has no correlation to the total cost.","The number of items has a weak correlation to the total cost.","The number of items has a moderate correlation to the total cost.","The number of items has a strong correlation to the total cost."],"correctAnswer":3,"explanation":"An r^2 value of 0.9947 is extremely close to 1, indicating that approximately 99.5% of the variation in total cost is explained by the number of items. This is a very strong correlation, meaning the linear model fits the data almost perfectly.","category":"Regression & Predictions","tags":["regression","r-squared","interpret"],"difficulty":1},{"id":65,"text":"A company has tracked the depreciating value of a company car over a 10-year period. The company performed a regression and modeled the value of the car, V, at year x with the function V(x) = 26,878.23e^(-0.21x) with r^2 = 0.98.\n [Graph: Car Depreciation]\n Would it be appropriate to use this model to make a prediction for the value of the car when the car is 12 years old?","options":["Yes, it would be appropriate because the data has a strong correlation, and 12 is within the range for accurate extrapolation.","Yes, it would be appropriate because 12 is an interpolation value.","No, it would not be appropriate because 12 is not close enough to the known data values, so it would be an extreme extrapolation value.","No, it would not be appropriate because 12 is an interpolation value."],"correctAnswer":2,"explanation":"The data covers years 0-10. Predicting at x = 12 is extrapolation (outside the known data range). While x = 12 is not extremely far from x = 10, it is far enough outside the 10-year data window that the model may not accurately represent real depreciation. This makes it an extreme extrapolation that should not be relied upon.","category":"Regression & Predictions","tags":["regression","extrapolation","appropriate"],"difficulty":2},{"id":66,"text":"A local university collects data related to its increasing enrollment for the past 19 years. The university models this with the logistic function P(t) = 9.51/(1 + 11.96e^(-0.37t)) with r^2 = 0.96, where t is time in years, and P is enrollment in thousands.\n [Graph: University Enrollment]\n Would it be appropriate for the university to use this model to predict enrollment five years from now (when t = 24)?","options":["Yes, t = 24 is an interpolation value.","Yes, the data are strongly correlated, so this would be considered a somewhat safe extrapolation.","No, the data is moderately correlated, so this would be considered too risky of an extrapolation.","No, t = 24 is an extreme extrapolation value."],"correctAnswer":1,"explanation":"The r^2 = 0.96 indicates very strong correlation. While t = 24 is outside the 19-year data range (extrapolation), it is only 5 years beyond, which is considered a somewhat safe extrapolation. Additionally, logistic functions naturally level off, so predictions slightly beyond the data are more reliable than with other model types.","category":"Regression & Predictions","tags":["regression","extrapolation","logistic","safe"],"difficulty":2},{"id":67,"text":"A company examined cost data in an effort to model the relationship between number of items produced, x, and cost, C. The regression equation is C(x) = 0.52x + 366 with a coefficient of determination of r^2 = 0.92. The company plans to use this function to determine the cost of producing 45 items.\n [Graph: Cost vs Items]\n Is the company's plan appropriate?","options":["No, it is not appropriate because the data should be modeled with a logistic function.","Yes, it is appropriate because as the number of items produced increases, so does the cost.","No, it is not appropriate because the data should be modeled with an exponential function.","Yes, it is appropriate because the coefficient of determination is close to 1, and this is an interpolation value."],"correctAnswer":3,"explanation":"The plan is appropriate for two reasons: (1) r^2 = 0.92 is close to 1, indicating a strong fit, and (2) x = 45 falls within the range of known data values, making it an interpolation (not extrapolation). Both conditions support making a reliable prediction.","category":"Regression & Predictions","tags":["regression","interpolation","r-squared"],"difficulty":2},{"id":68,"text":"A company has tracked the relationship between the selling price of an item, x, and the revenue generated by the sales of that item, f. The company performs a polynomial regression on the data and models the data with the function f(x) = -24.34x^2 + 336.21x + 53.88 with r^2 = 0.93.\n [Graph: Revenue vs Price]\n The company uses this model to predict that if it charges $12 per item, it will earn a revenue of approximately $583.44.\n Is this conclusion valid and why?","options":["No, it is not a valid conclusion because this data would be better modeled with a logistic function.","Yes, it is a valid conclusion because the relationship between selling price and revenue is quadratic.","No, it is not a valid conclusion because f(12) = 529.56.","Yes, it is a valid conclusion because f(12) = 583.44, r^2 is close to 1, and 12 is not far outside of the known data values."],"correctAnswer":3,"explanation":"Checking: f(12) = -24.34(144) + 336.21(12) + 53.88 = -3504.96 + 4034.52 + 53.88 = 583.44. The calculation is correct, r^2 = 0.93 indicates a strong fit, and x = 12 is close to the known data range. All three conditions validate the conclusion.","category":"Regression & Predictions","tags":["regression","polynomial","validate-prediction"],"difficulty":3},{"id":69,"text":"A company has tracked the relationship between the number of units of an item that sold, x, (measured in thousands) and the total revenue earned from the item in dollars, A. The company decided to perform an exponential regression and found the function A(x) = 223.7e^(0.04x) with r^2 = 0.76.\n [Graph: Revenue vs Units]\n The company uses this model to predict that when it sells 180,000 items, its revenue will be approximately $300,000.\n Is this a valid conclusion and why?","options":["Yes, this is a valid conclusion because A(180) = 300,000, and r^2 is close to 1, so the model is a good fit for the data.","Yes, this is a valid conclusion because the data is following an exponential pattern.","No, this is not a valid conclusion because A(180) = 200,000.","No, an accurate prediction cannot be made when x = 180 because it is too far from the known data values."],"correctAnswer":3,"explanation":"Even though r^2 = 0.76 suggests a moderate fit, x = 180 (180,000 items) is far outside the range of known data values. Extrapolating exponential functions far beyond the data range produces highly unreliable predictions. The extreme extrapolation makes this prediction invalid.","category":"Regression & Predictions","tags":["regression","extrapolation","invalid"],"difficulty":2},{"id":70,"text":"A company has tracked the depreciating value of a company car over an eight-year period. The company performed a linear regression and modeled the value of the car, V, at year x with the function V(x) = -2606.54x + 24109.37 with r^2 = 0.96.\n [Graph: Car Depreciation - Linear]\n Would it be appropriate to use this model to predict the value of the car when the car is 10 years old?","options":["Yes, it would be appropriate because r^2 is close to 1, and x = 10 is close to the given data values.","No, it would not be appropriate because this situation should be modeled using a quadratic function.","Yes, it would be appropriate because car depreciation should be modeled with a decreasing linear function.","No, it would not be appropriate because past x = 9 the linear trend will not continue, and data cannot be extrapolated."],"correctAnswer":0,"explanation":"The r^2 = 0.96 indicates a very strong linear correlation. Since the data covers 8 years and x = 10 is only 2 years beyond the data range, this is a close extrapolation. The strong fit combined with the proximity to known data makes this prediction appropriate.","category":"Regression & Predictions","tags":["regression","extrapolation","close","appropriate"],"difficulty":2}]}
</script>

</body>
</html>
